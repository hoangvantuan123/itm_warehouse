import{r as s,j as e,aI as D,aK as ae,B as F,aL as oe,s as I,a as q,aH as G,u as Q,F as C,b as Y,C as N,I as z,T as W,c as le,d as re}from"./index-Bs9yWD0t.js";import{d as J}from"./dayjs.min-Dv7_HJOV.js";import{l as Z}from"./lodash-Ce-vbS9w.js";import{G as v,D as ce,C as U}from"./index-OBdMMgIc.js";import"./moment-C0yF_v6Q.js";import"./index-Dh2nLnxp.js";import{R as ie,u as A,F as B,w as ue}from"./FileSaver.min-frEM_d-I.js";import{R as X}from"./FileTextOutlined-De0ON5I0.js";import{R as de}from"./DeleteOutlined-BXFM3QKl.js";import{R as he}from"./DownOutlined-DarA9UQs.js";import{R as me}from"./FileDoneOutlined-B7kzfAs5.js";import{G as pe}from"./getRootMenu-DZ4Z818c.js";import{R as xe}from"./TableOutlined-Dem2elRe.js";import{a as V}from"./tokenService-DihmZYU2.js";import{D as fe}from"./index-BGbAmcFH.js";import{S as _}from"./index-B0nsmOCQ.js";function ge({openModal:r,handleDeleteDataSheet:i,data:l}){s.useState(!1);const M=()=>{const h=A.json_to_sheet(l),p=A.sheet_to_csv(h),b=new Blob([p],{type:"text/csv;charset=utf-8;"});B.saveAs(b,"rootmenu.csv")},t=()=>{const h=A.json_to_sheet(l),p=A.book_new();A.book_append_sheet(p,h,"Sheet1");const b=ue(p,{bookType:"xlsx",type:"array"}),w=new Blob([b],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});B.saveAs(w,"rootmenu.xlsx")},o=()=>{const h=new Blob([JSON.stringify(l,null,2)],{type:"application/json"});B.saveAs(h,"rootmenu.json")},u=h=>{switch(h.key){case"csv":M();break;case"excel":t();break;case"json":o();break;case"delete":i();break;default:I.info("Chức năng này đang phát triển")}},g=e.jsxs(D,{onClick:u,className:" w-40",children:[e.jsxs(D.SubMenu,{title:"Export",children:[e.jsx(D.Item,{icon:e.jsx(X,{}),children:"CSV Export"},"csv"),e.jsx(D.Item,{icon:e.jsx(ie,{}),children:"Excel Export"},"excel"),e.jsx(D.Item,{icon:e.jsx(X,{}),children:"JSON Export"},"json")]},"export"),e.jsx(D.Item,{icon:e.jsx(de,{}),danger:!0,children:"Xóa"},"delete")]});return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{overlay:g,children:e.jsxs(F,{children:["Actions ",e.jsx(he,{})]})}),e.jsx(F,{icon:e.jsx(me,{}),size:"middle",className:"uppercase",type:"default",children:"Open"},"Reset"),e.jsx(F,{type:"primary",icon:e.jsx(oe,{}),size:"middle",onClick:r,style:{backgroundColor:"#4F46E5",borderColor:"#4F46E5"},children:"ADD MENU"},"Save")]})}function je({data:r,setSelection:i,selection:l,setShowSearch:M,showSearch:t}){const[o,u]=s.useState([]),g=s.useCallback(()=>M(!1),[]),[h,p]=s.useState(null);s.useState([]);const[b,w]=s.useState(!1),[y,S]=s.useState(null),n=s.useMemo(()=>[{title:"Menu Root ID"},{title:"Menu Sub Root ID"},{title:"Key"},{title:"Label",width:300},{title:"Link",width:350},{title:"Type"}],[]),[c,j]=s.useState(n),E=s.useCallback((a,R)=>{const f=c.indexOf(a);if(f!==-1){const k={...a,width:R},O=[...c];O.splice(f,1,k),j(O)}},[c]),L=s.useCallback(([a,R])=>{const f=o[R]||{},{MenuRootId:k="",MenuSubRootId:O="",Key:ee="",Label:se="",Link:te="",Type:ne=""}=f,T=$=>$!=null?String($):"",H={0:{kind:v.Text,data:T(k)},1:{kind:v.Text,data:T(O)},2:{kind:v.Text,data:T(ee)},3:{kind:v.Text,data:T(se)},4:{kind:v.Text,data:T(te)},5:{kind:v.Text,data:T(ne)}};if(H.hasOwnProperty(a)){const{kind:$,data:P}=H[a];return{kind:$,data:P,displayData:P}}return{kind:v.Text,data:"",displayData:""}},[o]),[x,d]=s.useState(void 0);s.useCallback(a=>{console.log("cell",a),d(a)},[]),s.useEffect(()=>{u(r)},[r]);const m=(a,R)=>{let f;if(a[0]!==-1){console.log("Ignoring click on cell, cell[0] is neither -1 nor 1");return}if(a[0]===-1?(f=a[1],w(!0)):(f=a[0],w(!1)),y&&y[0]===a[0]&&y[1]===a[1]){console.log("Click again on the same cell, deactivating."),S(null),p(null);return}if(f>=0&&f<o.length){const k=o[f];p(k),S(a)}};return e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs border-b font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(xe,{}),"DATA SHEET"]}),e.jsx(ce,{columns:c,getCellContent:L,rows:o.length,showSearch:t,getCellsForSelection:!0,onSearchClose:g,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:E,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:m,rowSelect:"multi",gridSelection:l,onGridSelectionChange:i,getRowThemeOverride:a=>a%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const ye=async(r,i,l,M,t,o)=>{try{const u=V(),g=await q.post(`${G}/mssql/system-users/itm-menu`,{Label:r,Type:i,Key:l,Link:M,MenuRootId:t,MenuSubRootId:o},{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});return g.status===200||g.status===201?{success:!0,message:g.data.message||"Operation successful",data:g.data}:{success:!1,message:`Unexpected status code: ${g.status}`}}catch(u){return{success:!1,message:u.response?u.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:be}=W,{Option:K}=_;function we({isOpen:r,onClose:i,fetchDataMenus:l,menus:M}){const{t}=Q(),o=JSON.parse(localStorage.getItem("userInfo"));o!=null&&o.login;const[u]=C.useForm();s.useState([]);const[g,h]=s.useState(!0);s.useState(null),s.useState(0),s.useState(1),s.useState(10),s.useState(0);const[p,b]=s.useState([]),w=s.useCallback(async()=>{h(!0);try{const n=await pe();b(n.data.data||[])}catch{b([])}finally{h(!1)}},[]),y=s.useMemo(()=>Z.debounce(w,100),[w]);s.useEffect(()=>(y(),()=>{y.cancel()}),[y]);const S=async n=>{const{Label:c,Type:j,Key:E,Link:L,MenuRootId:x,MenuSubRootId:d}=n;try{const m=await ye(c,j,E,L,x,d);m.success?(I.success(t("Tạo menu thành công")),l(),u.resetFields(),i()):I.error(m.message||t("Lỗi khi tạo menu"))}catch{I.error(t("Lỗi khi tạo menu"))}};return e.jsx(fe,{title:e.jsx(be,{level:5,children:t("Thêm Menu")}),open:r,closable:!1,width:600,extra:[e.jsx(F,{onClick:i,children:t("Hủy")},"cancel"),e.jsx(F,{type:"primary",className:" ml-2 border-gray-200  bg-indigo-600 text-white  shadow-sm text-sm",onClick:()=>u.submit(),children:t("Lưu")},"submit")],children:e.jsxs(C,{form:u,layout:"vertical",onFinish:S,style:{textAlign:"left"},className:"w-full",children:[e.jsxs(Y,{gutter:16,children:[e.jsx(N,{span:24,children:e.jsx(C.Item,{label:t("Tên menu"),name:"Label",rules:[{required:!0,message:t("Vui lòng nhập tên menu hiển thị")}],children:e.jsx(z,{size:"large",placeholder:t("Nhập tên menu hiển thị")})})}),e.jsx(N,{span:6,children:e.jsx(C.Item,{label:t("Type"),name:"Type",rules:[{required:!0,message:t("Vui lòng chọn kiểu menu")}],children:e.jsxs(_,{size:"large",placeholder:t("Type"),children:[e.jsx(K,{value:"submenu",children:t("Submenu")}),e.jsx(K,{value:"menu",children:t("Menu")})]})})}),e.jsx(N,{span:18,children:e.jsx(C.Item,{label:t("Key"),name:"Key",rules:[{required:!0,message:t("Vui lòng nhập Key")}],children:e.jsx(z,{size:"large",placeholder:t("Nhập key hiển thị")})})}),e.jsx(N,{span:24,children:e.jsx(C.Item,{label:t("Link"),name:"Link",children:e.jsx(z,{size:"large",placeholder:t("Nhập link")})})})]}),e.jsxs(Y,{gutter:16,children:[e.jsx(N,{span:24,children:e.jsx(C.Item,{label:t("Menu Root ID"),name:"MenuRootId",children:e.jsx(_,{showSearch:!0,placeholder:"Nhập Menu Root",optionFilterProp:"children",filterOption:(n,c)=>{var j;return(j=c==null?void 0:c.children)==null?void 0:j.toLowerCase().includes(n.toLowerCase())},size:"large",children:p.map(n=>e.jsx(K,{value:n.Id,className:" uppercase",children:n.Label},n.Id))})})}),e.jsx(N,{span:24,children:e.jsx(C.Item,{label:t("Menu Sub Root ID"),name:"MenuSubRootId",children:e.jsx(_,{showSearch:!0,placeholder:"Nhập Menu Sub Root",optionFilterProp:"children",filterOption:(n,c)=>{var j;return(j=c==null?void 0:c.children)==null?void 0:j.toLowerCase().includes(n.toLowerCase())},size:"large",children:M.map(n=>e.jsxs(K,{value:n.Id,children:[n.Type," -"," ",e.jsx("span",{className:"uppercase",children:n.Label})]},n.Id))})})})]})]})})}const Se=async()=>{try{const r=V();return{success:!0,data:(await q.get(`${G}/mssql/system-users/itm-menu-all`,{params:{},headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data}}catch(r){return{success:!1,message:r.response?r.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},ke=async r=>{try{const i=V(),l=await q.delete(`${G}/mssql/system-users/delete/menus`,{data:{ids:r},headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});return l.status===200||l.status===201?{success:!0,message:l.data.message||"Operation successful",data:l.data}:{success:!1,message:`Unexpected status code: ${l.status}`}}catch(i){return{success:!1,message:i.response?i.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:Me,Text:Be}=W;function qe({permissions:r,isMobile:i}){const{t:l}=Q();s.useRef(null),le();const[M,t]=s.useState(!1);s.useState([]);const[o,u]=s.useState([]);s.useState(J().startOf("month")),s.useState(J()),s.useState(null),s.useState(null),s.useState(!1),s.useCallback(x=>x.format("YYYYMMDD"),[]);const[g,h]=s.useState(!1),[p,b]=s.useState({columns:U.empty(),rows:U.empty()}),[w,y]=s.useState(!1),S=s.useCallback(async()=>{t(!0);try{const x=await Se();u(x.data.data||[])}catch{u([])}finally{t(!1)}},[]),n=s.useMemo(()=>Z.debounce(S,100),[S]);s.useEffect(()=>(n(),()=>{n.cancel()}),[n]);const c=()=>{h(!0)},j=()=>{h(!1)},E=()=>{const x=p.rows.items;let d=[];return x.forEach(m=>{var f;const a=m[0],R=m[1]-1;for(let k=a;k<=R;k++)d.push((f=o[k])==null?void 0:f.Id)}),d.filter(m=>m!==void 0)},L=s.useCallback(async x=>{const d=E();if(d.length===0){I.warning("Vui lòng chọn ít nhất một hàng để xóa.");return}o.filter(a=>!d.includes(a.id));const m=await ke(d);m.data.success?(n(),I.success(m.data.message)):I.error(m.data.message)},[o,p]);return s.useEffect(()=>{const x=d=>{(d.ctrlKey||d.metaKey)&&d.key==="f"&&(d.preventDefault(),y(!0))};return document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs("title",{children:["ITM - ",l("Menu Management")]})}),e.jsxs("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsx("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{level:4,className:"mt-2 uppercase opacity-85 ",children:l("Menu Management")}),e.jsx(ge,{fetchDataMenus:S,openModal:c,handleDeleteDataSheet:L,data:o})]})}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(je,{data:o,setSelection:b,selection:p,showSearch:w,setShowSearch:y})})]}),e.jsx(we,{isOpen:g,menus:o,onClose:j,fetchDataMenus:S})]})]})}export{qe as default};

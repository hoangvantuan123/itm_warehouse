import{j as e,B as V,R as le,r as t,C as X,G as n,D as ne,H as ie,a as re,E as W,F as M,b as ce,c as F,d as Z,I as oe,S as de,u as ue,e as ee,f as me,l as pe,g as xe,T as he,s as L,h as fe}from"./index-BJY6kUZk.js";import{A as ye}from"./index-BSunLTxl.js";import{R as Se}from"./SaveOutlined-NpHgz8zD.js";import{R as ge}from"./moment-BBTbne0X.js";import{G as Ce}from"./getCodeHelpCombo-BHQUlI4a.js";import{C as De}from"./index-UYRHXWUs.js";import{R as Ne}from"./FilterOutlined-DQCmG5q-.js";function ke({fetchData:m,nextPageStockIn:x,isAPISuccess:c}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{type:"default",icon:e.jsx(Se,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:x,children:"STOCK IN (IQC)"},"Reset"),e.jsx(V,{type:"primary",icon:e.jsx(le,{}),size:"middle",className:"uppercase",onClick:m,children:"SEARCH"},"Save")]})}function ve({data:m,onCellClicked:x,gridData:c,setGridData:D}){const[o,h]=t.useState(!1),v=t.useCallback(()=>h(!1),[]),[j,u]=t.useState({columns:X.empty(),rows:X.empty()}),T=t.useMemo(()=>[{title:"DelvNo"},{title:"DelvMngNo"},{title:"ImpType"},{title:"TotalQty"},{title:"OkQty"},{title:"RemainQty"},{title:"DelvDate"},{title:"CustSeq"},{title:"CustNm"},{title:"DomOrImp"},{title:"PurchaseType"},{title:"BizUnitName"},{title:"BizUnit"},{title:"EmpSeq"},{title:"EmpName"},{title:"DeptSeq"},{title:"DeptName"},{title:"CurrSeq"},{title:"CurrName"},{title:"ExRate"}],[]),[p,S]=t.useState(T),i=t.useCallback((r,N)=>{const k=p.indexOf(r);if(k!==-1){const g={...r,width:N},f=[...p];f.splice(k,1,g),S(f)}},[p]),w=t.useCallback(([r,N])=>{const k=c[N]||{},{DelvNo:g="",DelvMngNo:f="",ImpType:Y="",TotalQty:G="",OkQty:z="",RemainQty:$="",DelvDate:O="",CustSeq:b="",CustNm:B="",DomOrImp:J="",PurchaseType:P="",BizUnitName:R="",BizUnit:_="",EmpSeq:E="",EmpName:C="",DeptSeq:I="",DeptName:Q="",CurrSeq:U="",CurrName:A="",ExRate:H=""}=k,s=d=>d!=null?String(d):"",a={0:{kind:n.Text,data:s(g)},1:{kind:n.Text,data:s(f)},2:{kind:n.Text,data:s(Y)},3:{kind:n.Text,data:s(G)},4:{kind:n.Text,data:s(z)},5:{kind:n.Text,data:s($)},6:{kind:n.Text,data:s(O)},7:{kind:n.Text,data:s(b)},8:{kind:n.Text,data:s(B)},9:{kind:n.Text,data:s(J)},10:{kind:n.Text,data:s(P)},11:{kind:n.Text,data:s(R)},12:{kind:n.Text,data:s(_)},13:{kind:n.Text,data:s(E)},14:{kind:n.Text,data:s(C)},15:{kind:n.Text,data:s(I)},16:{kind:n.Text,data:s(Q)},17:{kind:n.Text,data:s(U)},18:{kind:n.Text,data:s(A)},19:{kind:n.Text,data:s(H)}};if(a.hasOwnProperty(r)){const{kind:d,data:y}=a[r];return{kind:d,data:y,displayData:y}}return{kind:n.Text,data:"",displayData:""}},[c]),[K,q]=t.useState(void 0);return t.useCallback(r=>{console.log("cell",r),q(r)},[]),t.useEffect(()=>{D(m)},[m]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(ge,{}),"DATA SHEET"]}),e.jsx(ne,{columns:p,getCellContent:w,rows:c.length,showSearch:o,getCellsForSelection:!0,onSearchClose:v,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:i,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:x,rowSelect:"single",gridSelection:j,onGridSelectionChange:u,getRowThemeOverride:r=>r%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const je=async(m,x,c,D)=>{try{const o=`${ie}/mssql/deliverry-list/itm-sug-get-active-delivery-web`,h=await re.get(o,{params:{fromDate:m,toDate:x,deliveryNo:c,delivbizUniteryNo:D},headers:{"Content-Type":"application/json"}});return h.status===200?{success:!0,data:h.data.data}:{success:!1,message:W.ERROR}}catch(o){return{success:!1,message:o.response?o.response.data.message:W.ERROR}}};function Te({formData:m,setFormData:x,setDeliveryNo:c,setToDate:D,toDate:o,deliveryNo:h,bizUnit:v,setBizUnit:j,dataUnit:u}){const T=i=>{x(i)},p=i=>{D(i)},S=i=>{j(i)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(M,{layout:"vertical",children:e.jsxs(ce,{className:"gap-4 flex items-center ",children:[e.jsx(F,{children:e.jsx(M.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 1"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:m,onChange:T})})}),e.jsx(F,{children:e.jsx(M.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 2"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:o,onChange:p,format:"YYYY-MM-DD"})})}),e.jsx(F,{children:e.jsx(M.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Delivery No"}),className:"mb-0",children:e.jsx(oe,{placeholder:"",value:h,size:"small",onChange:i=>c(i.target.value),className:" text-sm p-2"})})}),e.jsx(F,{children:e.jsx(M.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(de,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:S,options:u==null?void 0:u.map(i=>({label:i==null?void 0:i.AccUnitName,value:i==null?void 0:i.BizUnit}))})})})]})})})}const{Title:we,Text:Oe}=he;function Be({permissions:m,isMobile:x}){t.useRef(null);const c=ue(),[D,o]=t.useState(!1),[h,v]=t.useState(!1),[j,u]=t.useState([]),[T,p]=t.useState([]),[S,i]=t.useState(ee().startOf("month")),[w,K]=t.useState(ee()),[q,r]=t.useState(""),[N,k]=t.useState(4);t.useState(null);const[g,f]=t.useState(null),[Y,G]=t.useState(!1),z=t.useCallback(a=>a.format("YYYYMMDD"),[]),[$,O]=t.useState(!1),[b,B]=t.useState(null),[J,P]=t.useState(null);t.useState([]);const[R,_]=t.useState([]),[E,C]=t.useState(!0),{t:I}=me(),Q=async()=>{if(!E)return;o(!0),C(!1);let a;try{a=L.loading("Đang tải dữ liệu, vui lòng chờ...",0);const d=await je(S?z(S):"",w?z(w):"",q,N);d!=null&&d.success?(u(d.data||[]),L.success("Tải dữ liệu thành công!"),C(!0)):(u([]),C(!0),L.error("Có lỗi xảy ra khi tải dữ liệu."))}catch{u([]),C(!0),L.error("Có lỗi xảy ra khi tải dữ liệu.")}finally{a&&a(),C(!0),o(!1)}};t.useEffect(()=>{Q()},[]);const U=t.useCallback(async()=>{v(!0);try{const a=await Ce("",6,10003,1,"%","","","","");p((a==null?void 0:a.data)||[])}catch{p([])}finally{v(!1)}},[]),A=t.useMemo(()=>pe.debounce(U,100),[U]),H=t.useCallback(()=>{g&&c(`/u/warehouse/material/waiting-iqc-stock-in/${g}`)},[g,c]),s=(a,d)=>{let y;if(a[0]===-1){if(a[0]===-1?(y=a[1],O(!0)):(y=a[0],O(!1)),b&&b[0]===a[0]&&b[1]===a[1]){f(null),B(null),P(null);return}if(y>=0&&y<R.length){const l=R[y],te={DelvNo:l.DelvNo,DelvMngNo:l.DelvMngNo,ImpType:l.ImpType,TotalQty:l.TotalQty,OkQty:l.OkQty,RemainQty:l.RemainQty,DelvDate:l.DelvDate,CustSeq:l.CustSeq,CustNm:l.CustNm,DomOrImp:l.DomOrImp,PurchaseType:l.PurchaseType,BizUnitName:l.BizUnitName,BizUnit:l.BizUnit,EmpSeq:l.EmpSeq,EmpName:l.EmpName,DeptSeq:l.DeptSeq,DeptName:l.DeptName,CurrSeq:l.CurrSeq,CurrName:l.CurrName,ExRate:l.ExRate},se=De.AES.encrypt(JSON.stringify(te),"TEST_ACCESS_KEY").toString();if(E){const ae=fe(se);f(ae),P(l),B(a)}}}};return t.useEffect(()=>(A(),()=>{A.cancel()}),[A]),e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs("title",{children:["ITM - ",I("Delivery List")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{level:4,className:"mt-2 uppercase opacity-85 ",children:I("1")}),e.jsx(ke,{fetchData:Q,nextPageStockIn:H,isAPISuccess:E})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(Ne,{}),I("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(ye,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(Te,{formData:S,setFormData:i,setDeliveryNo:r,setToDate:K,toDate:w,deliveryNo:q,bizUnit:N,setBizUnit:k,dataUnit:T})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(ve,{data:j,setCheckedPath:G,checkedPath:Y,setKeyPath:f,loading:h,setData:u,onCellClicked:s,setGridData:_,gridData:R})})]})})]})}export{Be as default};

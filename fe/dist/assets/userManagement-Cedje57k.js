import{r as s,aq as W,a0 as Z,aH as J,a as X,j as e,aI as h,aJ as ee,aK as se,B as F,R as te,s as M,F as L,b as ae,C as H,I as q,u as ne,c as re,d as oe,T as le}from"./index-Bs9yWD0t.js";import{A as ce}from"./index-1TNXHxP6.js";import{d as G}from"./dayjs.min-Dv7_HJOV.js";import{E as K}from"./constants-BUjU6TAr.js";import{l as ie}from"./lodash-Ce-vbS9w.js";import{G as w,D as de,C as V}from"./index-OBdMMgIc.js";import{a as ue}from"./tokenService-DihmZYU2.js";import{R as me,u as N,F as B,w as pe}from"./FileSaver.min-frEM_d-I.js";import{R as Y}from"./FileTextOutlined-De0ON5I0.js";import{R as fe}from"./SaveOutlined-BK_GeTTb.js";import{R as he}from"./DeleteOutlined-BXFM3QKl.js";import{R as xe}from"./DownOutlined-DarA9UQs.js";import{R as ge}from"./FileDoneOutlined-B7kzfAs5.js";import{R as ye}from"./TableOutlined-Dem2elRe.js";import"./moment-C0yF_v6Q.js";import{R as je}from"./FilterOutlined-DaTDNfc6.js";var Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},we=function(n,t){return s.createElement(W,Z({},n,{ref:t,icon:Se}))},ve=s.forwardRef(we);const ke=async(l,n)=>{try{const t=`${J}/mssql/system-users/itm-roles-data-users-web`,d=await X.get(t,{params:{userId:l,userName:n},headers:{"Content-Type":"application/json"}});return d.status===200?{success:!0,data:d.data.data}:{success:!1,message:K.ERROR}}catch(t){return{success:!1,message:t.response?t.response.data.message:K.ERROR}}},be=async l=>{try{const n=ue(),t=await X.post(`${J}/acc/admin/update-passwords-2`,{userIds:l},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});return t.status===200||t.status===201?{success:!0,message:t.data.message||"Operation successful",data:t.data}:{success:!1,message:`Unexpected status code: ${t.status}`}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}};function Re({handleSearch:l,handleUpdatePassUsers:n,data:t}){s.useState(!1);const d=()=>{const r=N.json_to_sheet(t),u=N.sheet_to_csv(r),o=new Blob([u],{type:"text/csv;charset=utf-8;"});B.saveAs(o,"rootmenu.csv")},m=()=>{const r=N.json_to_sheet(t),u=N.book_new();N.book_append_sheet(u,r,"Sheet1");const o=pe(u,{bookType:"xlsx",type:"array"}),C=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});B.saveAs(C,"rootmenu.xlsx")},p=()=>{const r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});B.saveAs(r,"rootmenu.json")},I=r=>{switch(r.key){case"csv":d();break;case"excel":m();break;case"json":p();break;case"updatePass":n();break;default:M.info("Chức năng này đang phát triển")}},b=e.jsxs(h,{onClick:I,className:"w-auto",children:[e.jsxs(h.SubMenu,{title:"Export",children:[e.jsx(h.Item,{icon:e.jsx(Y,{}),children:"CSV Export"},"csv"),e.jsx(h.Item,{icon:e.jsx(me,{}),children:"Excel Export"},"excel"),e.jsx(h.Item,{icon:e.jsx(Y,{}),children:"JSON Export"},"json")]},"export"),e.jsx(h.Item,{icon:e.jsx(ee,{}),children:"Đặt lại mật khẩu mặc định"},"updatePass"),e.jsx(h.Item,{icon:e.jsx(fe,{}),children:"Lưu trữ"},"lutru"),e.jsx(h.Item,{icon:e.jsx(ve,{}),children:"Bỏ lưu trữ"},"bolutru"),e.jsx(h.Item,{icon:e.jsx(he,{}),danger:!0,children:"Xóa"},"delete")]});return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{overlay:b,children:e.jsxs(F,{children:["Actions ",e.jsx(xe,{})]})}),e.jsx(F,{icon:e.jsx(ge,{}),size:"middle",className:"uppercase",type:"default",children:"Open"},"Reset"),e.jsx(F,{type:"primary",icon:e.jsx(te,{}),size:"middle",onClick:l,className:"uppercase",children:"SEARCH"},"Save")]})}function Ce({data:l,setSelection:n,selection:t,showSearch:d,setShowSearch:m}){const[p,I]=s.useState([]),b=s.useCallback(()=>m(!1),[]);s.useState(null),s.useState([]),s.useState(!1),s.useState(null);const r=s.useCallback(c=>{},[]);s.useRef({cell:null,time:0});const u=s.useMemo(()=>[{title:"UserSeq"},{title:"UserName"},{title:"UserId"},{title:"DeptSeq"},{title:"Remark"},{title:"LoginDate"},{title:"LoginStatus"}],[]),[o,C]=s.useState(u),v=s.useCallback((c,x)=>{const g=o.indexOf(c);if(g!==-1){const y={...c,width:x},j=[...o];j.splice(g,1,y),C(j)}},[o]),O=s.useCallback(([c,x])=>{const g=p[x]||{},{UserSeq:y="",UserName:j="",UserId:S="",DeptSeq:A="",Remark:_="",LoginDate:E="",LoginStatus:k}=g,i=R=>R!=null?String(R):"",U={0:{kind:w.Text,data:i(y),readonly:!1},1:{kind:w.Text,data:i(j),readonly:!1},2:{kind:w.Text,data:i(S),readonly:!1},3:{kind:w.Text,data:i(A),readonly:!1},4:{kind:w.Text,data:i(_),readonly:!1},5:{kind:w.Text,data:i(E),readonly:!1},6:{kind:w.Text,data:i(k),readonly:!0}};if(U.hasOwnProperty(c)){const{kind:R,data:T,readonly:a}=U[c];return{kind:R,data:T,displayData:T,readonly:a,allowOverlay:!a}}return{kind:w.Text,data:"",displayData:"",readonly:!0,allowOverlay:!1}},[p]);s.useState(void 0),s.useEffect(()=>{I(l)},[l]);const z=s.useCallback((c,x)=>{if(x.kind!=="Text")return;const g=["UserSeq","UserName","UserId","DeptSeq","Remark","LoginDate","LoginStatus"],[y,j]=c,S=g[y];p[j][S]=x.gridData,console.log("key",S)},[]);return e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs  border-b font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(ye,{}),"DATA SHEET"]}),e.jsx(de,{columns:o,getCellContent:O,rows:p.length,showSearch:d,getCellsForSelection:!0,onSearchClose:b,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:v,onCellEdited:z,smoothScrollY:!0,smoothScrollX:!0,rowSelect:"multi",gridSelection:t,onCellActivated:r,onGridSelectionChange:n,getRowThemeOverride:c=>c%2===0?void 0:{bgCell:"#FBFBFB"},onPaste:!0,fillHandle:!0,keybindings:{downFill:!0,rightFill:!0},trailingRowOptions:{sticky:!0,tint:!0,hint:"New row..."}})]})})}function Ne({setUserName:l,userName:n,setUserId:t,userId:d}){return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(L,{layout:"vertical",children:e.jsxs(ae,{className:"gap-4 flex items-center ",children:[e.jsx(H,{children:e.jsx(L.Item,{label:e.jsx("span",{className:"uppercase text-xs",children:"Họ và Tên"}),className:"mb-0",children:e.jsx(q,{value:n,size:"small",onChange:m=>l(m.target.value),className:" text-sm p-2"})})}),e.jsx(H,{children:e.jsx(L.Item,{label:e.jsx("span",{className:"uppercase text-xs",children:"Mã nhân viên"}),className:"mb-0",children:e.jsx(q,{value:d,size:"small",onChange:m=>t(m.target.value),className:" text-sm p-2"})})})]})})})}const{Title:Ie,Text:Ge}=le;function Ke({permissions:l,isMobile:n}){const{t}=ne(),d=s.useRef(null);re(),s.useState("");const[m,p]=s.useState(!1),[I,b]=s.useState(!1);s.useState(!1);const[r,u]=s.useState([]);s.useState(G().startOf("month")),s.useState(G());const[o,C]=s.useState(""),[v,O]=s.useState(""),[z,c]=s.useState(null),[x,g]=s.useState(!1),[y,j]=s.useState(!1),[S,A]=s.useState({columns:V.empty(),rows:V.empty()}),[_,E]=s.useState(!1);s.useCallback(a=>a.format("YYYYMMDD"),[]);const k=s.useCallback(async()=>{p(!0);try{const a=await ke(o,v);u((a==null?void 0:a.data)||[])}catch{u([])}finally{p(!1)}},[o,v]),i=s.useMemo(()=>ie.debounce(k,300),[k]),U=()=>{j(!0),k()};s.useEffect(()=>{!o&&!v&&k()},[k,o,v]),s.useEffect(()=>(y&&i(),()=>{i.cancel()}),[i,y]);const R=()=>{const a=S.rows.items;let f=[];return a.forEach(D=>{const P=D[0],Q=D[1]-1;for(let $=P;$<=Q;$++)f.push($)}),f},T=s.useCallback(async()=>{b(!0);const a=M.loading("Updating passwords...",0);try{const D=R().map(P=>r[P].UserId);await be(D),a(),M.success("Passwords updated successfully!")}catch{M.error("Failed to update passwords. Please try again.")}finally{b(!1)}},[r,S]);return s.useEffect(()=>{const a=f=>{(f.ctrlKey||f.metaKey)&&f.key==="f"&&(f.preventDefault(),E(!0))};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsxs("title",{children:["ITM - ",t("User Management")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ie,{level:4,className:"mt-2 uppercase opacity-85 ",children:t("USER MANAGEMENT")}),e.jsx(Re,{handleSearch:U,handleUpdatePassUsers:T,data:r})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(je,{}),t("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(ce,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(Ne,{setUserId:C,userId:o,setUserName:O,userName:v})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg overflow-auto",children:e.jsx(Ce,{data:r,setCheckedPath:g,checkedPath:x,setKeyPath:c,loading:m,gridRef:d,setData:u,setSelection:A,selection:S,showSearch:_,setShowSearch:E})})]})})]})}export{Ke as default};

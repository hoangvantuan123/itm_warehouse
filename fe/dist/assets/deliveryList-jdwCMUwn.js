import{j as e,B as V,R as ne,r as s,u as te,C as X,G as l,D as ie,H as re,a as ce,E as W,F as A,b as oe,c as Q,d as Z,I as de,S as ue,e as me,f as ee,l as pe,g as xe,T as fe,s as K,h as he}from"./index-Ct_bw9RO.js";import{A as ye}from"./index-DUuALlMC.js";import{R as Se}from"./SaveOutlined-kstnGSZr.js";import{R as ge}from"./moment-BNDb4jO_.js";import{G as Ce}from"./getCodeHelpCombo-CwQrgFCZ.js";import{a as De}from"./tokenService-BTmKY_Sc.js";import{C as Ne}from"./index-fjSYZnj4.js";import{R as ke}from"./FilterOutlined-Dn7v8D7j.js";function ve({fetchData:m,nextPageStockIn:x,isAPISuccess:r}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{type:"default",icon:e.jsx(Se,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:x,children:"STOCK IN (IQC)"},"Reset"),e.jsx(V,{type:"primary",icon:e.jsx(ne,{}),size:"middle",className:"uppercase",onClick:m,children:"SEARCH"},"Save")]})}function je({data:m,onCellClicked:x,gridData:r,setGridData:C}){const[c,y]=s.useState(!1),f=s.useCallback(()=>y(!1),[]),{t:k}=te(),[o,v]=s.useState({columns:X.empty(),rows:X.empty()}),D=s.useMemo(()=>[{title:k("4179")},{title:"DelvMngNo"},{title:"ImpType"},{title:"TotalQty"},{title:"OkQty"},{title:"RemainQty"},{title:"DelvDate"},{title:"CustSeq"},{title:"CustNm"},{title:"DomOrImp"},{title:"PurchaseType"},{title:"BizUnitName"},{title:"BizUnit"},{title:"EmpSeq"},{title:"EmpName"},{title:"DeptSeq"},{title:"DeptName"},{title:"CurrSeq"},{title:"CurrName"},{title:"ExRate"}],[]),[d,n]=s.useState(D),j=s.useCallback((i,T)=>{const h=d.indexOf(i);if(h!==-1){const S={...i,width:T},N=[...d];N.splice(h,1,S),n(N)}},[d]),U=s.useCallback(([i,T])=>{const h=r[T]||{},{DelvNo:S="",DelvMngNo:N="",ImpType:Y="",TotalQty:z="",OkQty:$="",RemainQty:M="",DelvDate:b="",CustSeq:q="",CustNm:J="",DomOrImp:O="",PurchaseType:w="",BizUnitName:G="",BizUnit:R="",EmpSeq:g="",EmpName:E="",DeptSeq:B="",DeptName:P="",CurrSeq:I="",CurrName:_="",ExRate:H=""}=h,t=u=>u!=null?String(u):"",p={0:{kind:l.Text,data:t(S)},1:{kind:l.Text,data:t(N)},2:{kind:l.Text,data:t(Y)},3:{kind:l.Text,data:t(z)},4:{kind:l.Text,data:t($)},5:{kind:l.Text,data:t(M)},6:{kind:l.Text,data:t(b)},7:{kind:l.Text,data:t(q)},8:{kind:l.Text,data:t(J)},9:{kind:l.Text,data:t(O)},10:{kind:l.Text,data:t(w)},11:{kind:l.Text,data:t(G)},12:{kind:l.Text,data:t(R)},13:{kind:l.Text,data:t(g)},14:{kind:l.Text,data:t(E)},15:{kind:l.Text,data:t(B)},16:{kind:l.Text,data:t(P)},17:{kind:l.Text,data:t(I)},18:{kind:l.Text,data:t(_)},19:{kind:l.Text,data:t(H)}};if(p.hasOwnProperty(i)){const{kind:u,data:a}=p[i];return{kind:u,data:a,displayData:a}}return{kind:l.Text,data:"",displayData:""}},[r]),[L,F]=s.useState(void 0);return s.useCallback(i=>{console.log("cell",i),F(i)},[]),s.useEffect(()=>{C(m)},[m]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(ge,{}),"DATA SHEET"]}),e.jsx(ie,{columns:d,getCellContent:U,rows:r.length,showSearch:c,getCellsForSelection:!0,onSearchClose:f,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:j,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:x,rowSelect:"single",gridSelection:o,onGridSelectionChange:v,getRowThemeOverride:i=>i%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const Te=async(m,x,r,C)=>{try{const c=`${re}/mssql/deliverry-list/itm-sug-get-active-delivery-web`,y=De(),f=await ce.get(c,{params:{fromDate:m,toDate:x,deliveryNo:r,delivbizUniteryNo:C},headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}});return f.status===200?{success:!0,data:f.data.data}:{success:!1,message:W.ERROR}}catch(c){return{success:!1,message:c.response?c.response.data.message:W.ERROR}}};function be({formData:m,setFormData:x,setDeliveryNo:r,setToDate:C,toDate:c,deliveryNo:y,bizUnit:f,setBizUnit:k,dataUnit:o}){const v=n=>{x(n)},D=n=>{C(n)},d=n=>{k(n)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{layout:"vertical",children:e.jsxs(oe,{className:"gap-4 flex items-center ",children:[e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 1"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:m,onChange:v})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 2"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:c,onChange:D,format:"YYYY-MM-DD"})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Delivery No"}),className:"mb-0",children:e.jsx(de,{placeholder:"",value:y,size:"small",onChange:n=>r(n.target.value),className:" text-sm p-2"})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(ue,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:d,options:[{label:"All",value:"0"},...(o==null?void 0:o.map(n=>({label:n==null?void 0:n.AccUnitName,value:n==null?void 0:n.BizUnit})))||[]]})})})]})})})}const{Title:we,Text:Pe}=fe;function Qe({permissions:m,isMobile:x}){s.useRef(null);const r=me(),[C,c]=s.useState(!1),[y,f]=s.useState(!1),[k,o]=s.useState([]),[v,D]=s.useState([]),[d,n]=s.useState(ee().startOf("month")),[j,U]=s.useState(ee()),[L,F]=s.useState(""),[i,T]=s.useState(0);s.useState(null);const[h,S]=s.useState(null),[N,Y]=s.useState(!1),z=s.useCallback(t=>t.format("YYYYMMDD"),[]),[$,M]=s.useState(!1),[b,q]=s.useState(null),[J,O]=s.useState(null);s.useState([]);const[w,G]=s.useState([]),[R,g]=s.useState(!0),{t:E}=te(),B=async()=>{if(!R)return;c(!0),g(!1);let t;try{t=K.loading("Đang tải dữ liệu, vui lòng chờ...",0);const p=await Te(d?z(d):"",j?z(j):"",L,i);p!=null&&p.success?(o(p.data||[]),g(!0)):(o([]),g(!0),K.error("Có lỗi xảy ra khi tải dữ liệu."))}catch{o([]),g(!0),K.error("Có lỗi xảy ra khi tải dữ liệu.")}finally{t&&t(),g(!0),c(!1)}};s.useEffect(()=>{B()},[]);const P=s.useCallback(async()=>{f(!0);try{const t=await Ce("",6,10003,1,"%","","","","");D((t==null?void 0:t.data)||[])}catch{D([])}finally{f(!1)}},[]),I=s.useMemo(()=>pe.debounce(P,100),[P]),_=s.useCallback(()=>{h&&r(`/u/warehouse/material/waiting-iqc-stock-in/${h}`)},[h,r]),H=(t,p)=>{let u;if(t[0]===-1){if(t[0]===-1?(u=t[1],M(!0)):(u=t[0],M(!1)),b&&b[0]===t[0]&&b[1]===t[1]){S(null),q(null),O(null);return}if(u>=0&&u<w.length){const a=w[u],se={DelvNo:a.DelvNo,DelvMngNo:a.DelvMngNo,ImpType:a.ImpType,TotalQty:a.TotalQty,OkQty:a.OkQty,RemainQty:a.RemainQty,DelvDate:a.DelvDate,CustSeq:a.CustSeq,CustNm:a.CustNm,DomOrImp:a.DomOrImp,PurchaseType:a.PurchaseType,BizUnitName:a.BizUnitName,BizUnit:a.BizUnit,EmpSeq:a.EmpSeq,EmpName:a.EmpName,DeptSeq:a.DeptSeq,DeptName:a.DeptName,CurrSeq:a.CurrSeq,CurrName:a.CurrName,ExRate:a.ExRate},ae=Ne.AES.encrypt(JSON.stringify(se),"TEST_ACCESS_KEY").toString();if(R){const le=he(ae);S(le),O(a),q(t)}}}};return s.useEffect(()=>(I(),()=>{I.cancel()}),[I]),e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs("title",{children:["ITM - ",E("Delivery List")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{level:4,className:"mt-2 uppercase opacity-85 ",children:E("Delivery List")}),e.jsx(ve,{fetchData:B,nextPageStockIn:_,isAPISuccess:R})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(ke,{}),E("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(ye,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(be,{formData:d,setFormData:n,setDeliveryNo:F,setToDate:U,toDate:j,deliveryNo:L,bizUnit:i,setBizUnit:T,dataUnit:v})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(je,{data:k,setCheckedPath:Y,checkedPath:N,setKeyPath:S,loading:y,setData:o,onCellClicked:H,setGridData:G,gridData:w})})]})})]})}export{Qe as default};

import{j as e,B as $,R as te,r as s,H as se,a as ae,F as w,b as le,C as Q,I as ne,u as re,c as ie,d as oe,T as ce,e as de}from"./index-Bs9yWD0t.js";import{A as me}from"./index-1TNXHxP6.js";import{d as J}from"./dayjs.min-Dv7_HJOV.js";import{R as ue}from"./SaveOutlined-BK_GeTTb.js";import{C as V,G as l,D as pe,a as xe}from"./index-OBdMMgIc.js";import{R as fe}from"./TableOutlined-Dem2elRe.js";import{D as X,G as he,s as W}from"./getCodeHelpCombo-CaeqAGEw.js";import{E as Z}from"./constants-BUjU6TAr.js";import"./moment-C0yF_v6Q.js";import{S as ye}from"./index-B0nsmOCQ.js";import{l as De}from"./lodash-Ce-vbS9w.js";import"./vi-CDnV5VIF.js";import{R as Ce}from"./FilterOutlined-DaTDNfc6.js";import"./DownOutlined-DarA9UQs.js";function Se({fetchData:m,nextPageStockIn:u}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"default",icon:e.jsx(ue,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:u,children:"STOCK IN (IQC)"},"Reset"),e.jsx($,{type:"primary",icon:e.jsx(te,{}),size:"middle",className:"uppercase",onClick:m,children:"SEARCH"},"Save")]})}function Ne({data:m,onCellClicked:u,gridData:i,setGridData:p}){const[c,o]=s.useState(!1),b=s.useCallback(()=>o(!1),[]),[f,h]=s.useState({columns:V.empty(),rows:V.empty()}),C=s.useMemo(()=>[{title:"DelvNo"},{title:"DelvMngNo"},{title:"ImpType"},{title:"TotalQty"},{title:"OkQty"},{title:"RemainQty"},{title:"DelvDate"},{title:"CustSeq"},{title:"CustNm"},{title:"DomOrImp"},{title:"PurchaseType"},{title:"BizUnitName"},{title:"BizUnit"},{title:"EmpSeq"},{title:"EmpName"},{title:"DeptSeq"},{title:"DeptName"},{title:"CurrSeq"},{title:"CurrName"},{title:"ExRate"}],[]),[d,N]=s.useState(C),n=s.useCallback((r,g)=>{const x=d.indexOf(r);if(x!==-1){const y={...r,width:g},S=[...d];S.splice(x,1,y),N(S)}},[d]),U=s.useCallback(([r,g])=>{const x=i[g]||{},{DelvNo:y="",DelvMngNo:S="",ImpType:L="",TotalQty:R="",OkQty:H="",RemainQty:E="",DelvDate:k="",CustSeq:I="",CustNm:K="",DomOrImp:q="",PurchaseType:v="",BizUnitName:Y="",BizUnit:z="",EmpSeq:M="",EmpName:j="",DeptSeq:G="",DeptName:_="",CurrSeq:a="",CurrName:O="",ExRate:D=""}=x,t=T=>T!=null?String(T):"",A={0:{kind:l.Text,data:t(y)},1:{kind:l.Text,data:t(S)},2:{kind:l.Text,data:t(L)},3:{kind:l.Text,data:t(R)},4:{kind:l.Text,data:t(H)},5:{kind:l.Text,data:t(E)},6:{kind:l.Text,data:t(k)},7:{kind:l.Text,data:t(I)},8:{kind:l.Text,data:t(K)},9:{kind:l.Text,data:t(q)},10:{kind:l.Text,data:t(v)},11:{kind:l.Text,data:t(Y)},12:{kind:l.Text,data:t(z)},13:{kind:l.Text,data:t(M)},14:{kind:l.Text,data:t(j)},15:{kind:l.Text,data:t(G)},16:{kind:l.Text,data:t(_)},17:{kind:l.Text,data:t(a)},18:{kind:l.Text,data:t(O)},19:{kind:l.Text,data:t(D)}};if(A.hasOwnProperty(r)){const{kind:T,data:B}=A[r];return{kind:T,data:B,displayData:B}}return{kind:l.Text,data:"",displayData:""}},[i]),[P,F]=s.useState(void 0);return s.useCallback(r=>{console.log("cell",r),F(r)},[]),s.useEffect(()=>{p(m)},[m]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(fe,{}),"DATA SHEET"]}),e.jsx(pe,{columns:d,getCellContent:U,rows:i.length,showSearch:c,getCellsForSelection:!0,onSearchClose:b,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:n,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:u,rowSelect:"single",gridSelection:f,onGridSelectionChange:h,getRowThemeOverride:r=>r%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const ge=async(m,u,i,p)=>{try{const c=`${se}/mssql/deliverry-list/itm-sug-get-active-delivery-web`,o=await ae.get(c,{params:{fromDate:m,toDate:u,deliveryNo:i,delivbizUniteryNo:p},headers:{"Content-Type":"application/json"}});return o.status===200?{success:!0,data:o.data.data}:{success:!1,message:Z.ERROR}}catch(c){return{success:!1,message:c.response?c.response.data.message:Z.ERROR}}};function ke({formData:m,setFormData:u,setDeliveryNo:i,setToDate:p,toDate:c,deliveryNo:o,bizUnit:b,setBizUnit:f,dataUnit:h}){const C=n=>{u(n)},d=n=>{p(n)},N=n=>{f(n)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(w,{layout:"vertical",children:e.jsxs(le,{className:"gap-4 flex items-center ",children:[e.jsx(Q,{children:e.jsx(w.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 1"}),className:"mb-0",children:e.jsx(X,{className:"w-full text-sm p-2",value:m,onChange:C})})}),e.jsx(Q,{children:e.jsx(w.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 2"}),className:"mb-0",children:e.jsx(X,{className:"w-full text-sm p-2",value:c,onChange:d,format:"YYYY-MM-DD"})})}),e.jsx(Q,{children:e.jsx(w.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Delivery No"}),className:"mb-0",children:e.jsx(ne,{placeholder:"",value:o,size:"small",onChange:n=>i(n.target.value),className:" text-sm p-2"})})}),e.jsx(Q,{children:e.jsx(w.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(ye,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:N,options:h==null?void 0:h.map(n=>({label:n==null?void 0:n.AccUnitName,value:n==null?void 0:n.BizUnit}))})})})]})})})}const{Title:ve,Text:Ue}=ce;function Pe({permissions:m,isMobile:u}){const{t:i}=re();s.useRef(null);const p=ie(),[c,o]=s.useState(!1),[b,f]=s.useState([]),[h,C]=s.useState([]),[d,N]=s.useState(J().startOf("month")),[n,U]=s.useState(J()),[P,F]=s.useState(""),[r,g]=s.useState(4);s.useState(null);const[x,y]=s.useState(null),[S,L]=s.useState(!1),R=s.useCallback(a=>a.format("YYYYMMDD"),[]),[H,E]=s.useState(!1),[k,I]=s.useState(null),[K,q]=s.useState(null);s.useState([]);const[v,Y]=s.useState([]),z=async()=>{o(!0);try{const a=await ge(d?R(d):"",n?R(n):"",P,r),O=(a==null?void 0:a.data)||[];f(O)}catch{f([]),W.destroy(),W.error({message:"Lỗi",description:"Có lỗi xảy ra khi tải dữ liệu."})}finally{o(!1)}},M=s.useCallback(async()=>{o(!0);try{const a=await he("",6,10003,1,"%","","","","");C((a==null?void 0:a.data)||[])}catch{C([])}finally{o(!1)}},[]),j=s.useMemo(()=>De.debounce(M,100),[M]),G=s.useCallback(()=>{x&&p(`/u/warehouse/material/waiting-iqc-stock-in/${x}`)},[x,p]),_=(a,O)=>{let D;if(a[0]===-1){if(a[0]===-1?(D=a[1],E(!0)):(D=a[0],E(!1)),k&&k[0]===a[0]&&k[1]===a[1]){y(null),I(null),q(null);return}if(D>=0&&D<v.length){const t=v[D],A={DelvNo:t.DelvNo,DelvMngNo:t.DelvMngNo,ImpType:t.ImpType,TotalQty:t.TotalQty,OkQty:t.OkQty,RemainQty:t.RemainQty,DelvDate:t.DelvDate,CustSeq:t.CustSeq,CustNm:t.CustNm,DomOrImp:t.DomOrImp,PurchaseType:t.PurchaseType,BizUnitName:t.BizUnitName,BizUnit:t.BizUnit,EmpSeq:t.EmpSeq,EmpName:t.EmpName,DeptSeq:t.DeptSeq,DeptName:t.DeptName,CurrSeq:t.CurrSeq,CurrName:t.CurrName,ExRate:t.ExRate},B=xe.AES.encrypt(JSON.stringify(A),"TEST_ACCESS_KEY").toString(),ee=de(B);y(ee),q(t),I(a)}}};return s.useEffect(()=>{z()},[]),s.useEffect(()=>(j(),()=>{j.cancel()}),[j]),e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsxs("title",{children:["ITM - ",i("Delivery List")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ve,{level:4,className:"mt-2 uppercase opacity-85 ",children:i("Delivery List")}),e.jsx(Se,{fetchData:z,nextPageStockIn:G})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(Ce,{}),i("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(me,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(ke,{formData:d,setFormData:N,setDeliveryNo:F,setToDate:U,toDate:n,deliveryNo:P,bizUnit:r,setBizUnit:g,dataUnit:h})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(Ne,{data:b,setCheckedPath:L,checkedPath:S,setKeyPath:y,loading:c,setData:f,onCellClicked:_,setGridData:Y,gridData:v})})]})})]})}export{Pe as default};

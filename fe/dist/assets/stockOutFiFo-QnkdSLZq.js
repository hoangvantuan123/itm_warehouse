import{j as t,B as R,r as o,f as xe,F as ee,b as Xe,c as ae,I as he,a9 as pe,C as te,G as k,D as qe,H as oe,a as ne,E as ge,u as Ke,e as Ge,i as Ye,bu as Ve,l as Je,s as ie,g as Ze,T as Re}from"./index-ayyTO2Yu.js";import{a as et,A as tt}from"./index-D2oIM98g.js";import{C as fe}from"./index-CelGP5ee.js";import{R as ke}from"./SaveOutlined-Bl2C5slq.js";import{R as ot}from"./DeleteOutlined-D40cpE60.js";import{R as nt}from"./UploadOutlined-BW7lOCVG.js";import{L as rt,S as lt}from"./successSubmit-D7Jv6sVO.js";import"./index-D3q4azbu.js";import{a as re}from"./tokenService-CcOQ_w6w.js";import{M as st}from"./modalWaiting-B4RZtkJr.js";import{R as at}from"./FileTextOutlined-D3FIqZCA.js";import"./ExclamationCircleOutlined-DlelRtt7.js";function it({status:n,handleSubmit:a,handleDelete:c,handleRestFrom:u,handleUploadExcel:p}){return t.jsxs("div",{className:"flex items-center gap-2",children:[n?t.jsx(t.Fragment,{children:t.jsx("span",{className:"inline-flex items-center justify-center rounded-lg w-20 bg-emerald-100 px-5 py-[6px] text-emerald-700",children:t.jsx("p",{className:"whitespace-nowrap text-sm",children:"LIVE"})})}):t.jsx(t.Fragment,{children:t.jsx("span",{className:"inline-flex items-center justify-center rounded-lg w-20 bg-red-100 px-5 py-[6px] text-red-700",children:t.jsx("p",{className:"whitespace-nowrap text-sm",children:"OFF"})})}),t.jsx(R,{type:"primary",icon:t.jsx(ke,{}),size:"middle",className:"uppercase",onClick:a,style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"Save"},"Save"),t.jsx(R,{type:"primary",icon:t.jsx(ot,{}),size:"middle",onClick:c,className:"uppercase text-white",style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"},children:"Row Delete"},"Row Delete"),t.jsx(R,{type:"default",icon:t.jsx(ke,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",onClick:u,style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},children:"Reset"},"Reset"),t.jsx(R,{type:"default",icon:t.jsx(nt,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",onClick:p,style:{backgroundColor:"#ffa500",borderColor:"#ffa500"},children:"Excel Upload"},"Excel Upload")]})}xe.locale("vi");function ct({filteredData:n,handleCheckBarcode:a,inputBarCode:c,setInputBarCode:u,setCheckValueIsStop:p}){const[m]=o.useState(xe()),[D,v]=o.useState(n==null?void 0:n.IsStop),X=x=>{const N=x.format("dddd");return`${N.charAt(0).toUpperCase()+N.slice(1)}, ${x.format("DD/MM/YYYY")}`},b=x=>{u(x.target.value)},U=()=>{c&&a(c)},I=x=>{v(x.target.checked);const N=x.target.checked?1:0;p(N)};return t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(ee,{layout:"vertical",onKeyDown:x=>{x.key==="Enter"&&x.preventDefault()},children:[" ",t.jsxs(Xe,{className:"gap-4 flex items-center",children:[t.jsx(ae,{children:t.jsx(ee.Item,{label:t.jsx("span",{className:"uppercase text-[10px]",children:"Date"}),className:"mb-0",children:t.jsx(he,{value:X(m),size:"small",className:"text-sm p-2",readOnly:!0})})}),t.jsx(ae,{children:t.jsx(ee.Item,{label:t.jsx("span",{className:"uppercase text-[10px]",children:"Barcode"}),tooltip:"Dùng để nhập mã vạch",className:"mb-0",children:t.jsx(he,{value:c,onChange:b,onPressEnter:U,placeholder:"Barcode",size:"small",className:"text-sm p-2  w-80"})})}),t.jsx(ae,{children:t.jsx(ee.Item,{label:t.jsx("span",{className:"uppercase text-[10px]",children:"Trạng thái Y/N"}),className:"mb-0",children:(n==null?void 0:n.IsStop)===!0?t.jsx(t.Fragment,{children:t.jsx(pe,{onChange:I,children:t.jsx("span",{className:"uppercase",children:"Đơn hàng hoàn thành"})})}):t.jsxs(t.Fragment,{children:[" ",t.jsx(pe,{onChange:I,children:D?t.jsx("span",{className:" uppercase",children:"Đơn hàng hoàn thành"}):t.jsx("span",{className:"uppercase",children:"Đơn hàng chưa hoàn thành"})})]})})})]})]})})}function ut({data:n}){const[a,c]=o.useState([]),[u,p]=o.useState(!1),m=o.useCallback(()=>p(!1),[]),[D,v]=o.useState(null);o.useState([]);const[X,b]=o.useState(!1),[U,I]=o.useState(null),[x,N]=o.useState({columns:te.empty(),rows:te.empty()}),B=o.useMemo(()=>[{title:"ItemNo"},{title:"RemainQty"},{title:"OutQty"},{title:"Qty1"},{title:"ItemName"},{title:"Spec"},{title:"UnitName"}],[]),[g,M]=o.useState(B),Q=o.useCallback((l,W)=>{const d=g.indexOf(l);if(d!==-1){const f={...l,width:W},F=[...g];F.splice(d,1,f),M(F)}},[g]),K=o.useCallback(([l,W])=>{const d=a[W]||{},{ItemNo:f="",RemainQty:F="",OutQty:Y="",Qty1:h="",ItemName:L="",Spec:_="",UnitName:V=""}=d,y=$=>$!=null?String($):"",C={0:{kind:k.Text,data:y(f)},1:{kind:k.Text,data:y(F)},2:{kind:k.Text,data:y(Y)},3:{kind:k.Text,data:y(h)},4:{kind:k.Text,data:y(L)},5:{kind:k.Text,data:y(_)},6:{kind:k.Text,data:y(V)}};if(C.hasOwnProperty(l)){const{kind:$,data:H}=C[l];return{kind:$,data:H,displayData:H}}return{kind:k.Text,data:"",displayData:""}},[a]),[E,G]=o.useState(void 0);o.useCallback(l=>{console.log("cell",l),G(l)},[]),o.useEffect(()=>{c(n)},[n]);const T=(l,W)=>{let d;if(l[0]!==-1){console.log("Ignoring click on cell, cell[0] is neither -1 nor 1");return}if(l[0]===-1?(d=l[1],b(!0)):(d=l[0],b(!1)),U&&U[0]===l[0]&&U[1]===l[1]){console.log("Click again on the same cell, deactivating."),I(null),v(null);return}if(d>=0&&d<a.length){const f=a[d];v(f),I(l)}else console.log("Invalid row index:",d)};return t.jsx("div",{className:"w-full h-full border-t border-b overflow-hidden scroll-container ",children:t.jsx(qe,{columns:g,getCellContent:K,rows:a.length,showSearch:u,getCellsForSelection:!0,onSearchClose:m,width:"100%",height:"100%",rowMarkers:"both",useRef:o.useRef,onColumnResize:Q,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:T,rowSelect:"single",gridSelection:x,onGridSelectionChange:N,getRowThemeOverride:l=>l%2===0?void 0:{bgCell:"#FBFBFB"}})})}function mt({data:n,selection:a,setSelection:c}){const[u,p]=o.useState([]),[m,D]=o.useState(!1),v=o.useCallback(()=>D(!1),[]),[X,b]=o.useState(null),[U,I]=o.useState(!1),[x,N]=o.useState(null),B=o.useMemo(()=>[{title:"FactUnitName"},{title:"InWHName"},{title:"OutWHName"},{title:"Qty"},{title:"ReqQty"},{title:"DateCode"},{title:"ReelNo"},{title:"StockOutDate"},{title:"LotNo"},{title:"LotNoFull"},{title:"Barcode"}],[]),[g,M]=o.useState(B),Q=o.useCallback((l,W)=>{const d=g.indexOf(l);if(d!==-1){const f={...l,width:W},F=[...g];F.splice(d,1,f),M(F)}},[g]),K=o.useCallback(([l,W])=>{const d=u[W]||{},{FactUnitName:f="",InWHName:F="",OutWHName:Y="",Qty:h="",ReqQty:L="",DateCode:_="",ReelNo:V="",StockOutDate:y="",LotNo:C="",LotNoFull:$="",Barcode:H=""}=d,w=z=>z!=null?String(z):"",P={0:{kind:k.Text,data:w(f)},1:{kind:k.Text,data:w(F)},2:{kind:k.Text,data:w(Y)},3:{kind:k.Text,data:w(h)},4:{kind:k.Text,data:w(L)},5:{kind:k.Text,data:w(_)},6:{kind:k.Text,data:w(V)},7:{kind:k.Text,data:w(y)},8:{kind:k.Text,data:w(C)},9:{kind:k.Text,data:w($)},10:{kind:k.Text,data:w(H)}};if(P.hasOwnProperty(l)){const{kind:z,data:le}=P[l];return{kind:z,data:le,displayData:le}}return{kind:k.Text,data:"",displayData:""}},[u]),[E,G]=o.useState(void 0);o.useCallback(l=>{G(l)},[]),o.useEffect(()=>{p(n)},[n]);const T=(l,W)=>{let d;if(l[0]!==-1){console.log("Ignoring click on cell, cell[0] is neither -1 nor 1");return}if(l[0]===-1?(d=l[1],I(!0)):(d=l[0],I(!1)),x&&x[0]===l[0]&&x[1]===l[1]){console.log("Click again on the same cell, deactivating."),N(null),b(null);return}if(d>=0&&d<u.length){const f=u[d];b(f),N(l)}else console.log("Invalid row index:",d)};return t.jsx("div",{className:"w-full h-full border-t border-b overflow-hidden scroll-container ",children:t.jsx(qe,{columns:g,getCellContent:K,rows:u.length,showSearch:m,getCellsForSelection:!0,onSearchClose:v,width:"100%",height:"100%",rowMarkers:"both",useRef:o.useRef,onColumnResize:Q,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:T,rowSelect:"single",gridSelection:a,onGridSelectionChange:c,getRowThemeOverride:l=>l%2===0?void 0:{bgCell:"#FBFBFB"}})})}function dt({sampleTableA:n,sampleTableB:a,setSelection:c,selection:u}){return t.jsxs("div",{className:"w-full gap-1 h-full flex items-center justify-center",children:[t.jsxs("div",{className:"w-[55%] h-full flex flex-col border bg-white rounded-lg overflow-hidden pb-7",children:[t.jsx("div",{className:" text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase ",children:"B"}),t.jsx(mt,{data:a,setSelection:c,selection:u})]}),t.jsx("div",{className:"px-4 flex flex-col p-3  bg-[#eee] rounded-lg items-center justify-center",children:t.jsx(et,{})}),t.jsxs("div",{className:"w-[45%] h-full flex flex-col border bg-white rounded-lg overflow-hidden pb-7",children:[t.jsx("div",{className:" text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase ",children:"A"}),t.jsx(ut,{data:n})]})]})}const ht=async n=>{try{const a=`${oe}/mssql/stock-out/itm-spd-mm-out-req-item-list`,c=re(),u=await ne.get(a,{params:{outReqSeq:n},headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});return u.status===200?{success:!0,data:u.data.data}:{success:!1,message:ge.ERROR}}catch(a){return{success:!1,message:a.response?a.response.data.message:ge.ERROR}}},pt=n=>`
        <DataBlock1>
          <WorkingTag>${n.WorkingTag}</WorkingTag>
          <IDX_NO>1</IDX_NO>
          <Status>0</Status>
          <DataSeq>1</DataSeq>
          <Selected>1</Selected>
          <TABLE_NAME>DataBlock1</TABLE_NAME>
          <OutReqSeq>${n.OutReqSeq}</OutReqSeq>
          <OutReqItemSerl>${n.OutReqItemSerl}</OutReqItemSerl>
          <WorkOrderSeq>${n.WorkOrderSeq}</WorkOrderSeq>
          <WorkOrderSerl>${n.WorkOrderSerl}</WorkOrderSerl>
          <FactUnit>${n.FactUnit}</FactUnit>
          <FactUnitName>${n.FactUnitName}</FactUnitName>
          <InWHSeq>${n.InWHSeq}</InWHSeq>
          <InWHName>${n.InWHName}</InWHName>>
          <OutWHSeq>${n.OutWHSeq}</OutWHSeq>
          <OutWHName>${n.OutWHName}</OutWHName>
          <ItemSeq>${n.ItemSeq}</ItemSeq>
          <UnitSeq>${n.UnitSeq}</UnitSeq>
          <ItemNo>${n.ItemNo}</ItemNo>
          <LotNo>${n.LotNo}</LotNo>
          <Qty>${n.Qty}</Qty>
          <DateCode>${n.DateCode}</DateCode>
          <ReelNo>${n.ReelNo}</ReelNo>
          <Barcode>${n.Barcode}</Barcode>
        </DataBlock1>
    `,gt={xmlFlags:2,serviceSeq:60010002,workingTag:"",languageSeq:6,pgmSeq:1036085},ft=n=>{const a={...gt,...n},c=re(),p={xmlDocument:pt(a),xmlFlags:a.xmlFlags,serviceSeq:a.serviceSeq,workingTag:a.workingTag,languageSeq:a.languageSeq,pgmSeq:a.pgmSeq};return ne.post(`${oe}/mssql/stock-out/smaterial-qr-check-stock-out-web`,p,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}}).then(m=>{if(m.status===200||m.status===201)return m.data;throw new Error("Error from API: "+m.data.message)}).catch(m=>{const D=m.response?m.response.data.message||"Error from API":"Unknown error occurred";throw new Error(D)})},kt={xmlFlags:2,serviceSeq:2639,workingTag:"",languageSeq:6,pgmSeq:1036085},St=async(n,a,c,u)=>{try{const p=re(),m={...kt,checkValueIsStop:n,outReqSeq:a,dataSave:c,xmlDocument:{xmlSCOMCloseCheckWEB:u.xmlSCOMCloseCheckWEB,xmlSCOMCloseItemCheckWEB:u.xmlSCOMCloseItemCheckWEB,xmlSPDMMOutProcCheckWEB:u.xmlSPDMMOutProcCheckWEB,xmlSPDMMOutProcItemCheckWEB:u.xmlSPDMMOutProcItemCheckWEB}},D=await ne.post(`${oe}/mssql/stock-out/check-all-procedures-stock-out-fifo`,m,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(D.status>=200&&D.status<300)return D.data;throw new Error("Unexpected response status: "+D.status)}catch(p){let m="Unknown error occurred";throw p.response?m=p.response.data.message||`API error with status ${p.response.status}`:p.request?m="No response received from the server":m=p.message,new Error(m)}},Se=async n=>{try{const a=re(),c=await ne.delete(`${oe}/mssql/stock-out/items-tfifo-list-temp`,{data:{items:n},headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});return c.status===200||c.status===201?{success:!0,message:c.data.message||"Operation successful",data:c.data}:{success:!1,message:`Unexpected status code: ${c.status}`}}catch(a){return{success:!1,message:a.response?a.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:xt,Text:vt}=Re;function Bt({permissions:n,isMobile:a}){const{t:c}=Ke(),u=Ge(),{id:p}=Ye(),m=o.useRef(null),[D,v]=o.useState(null),[X,b]=o.useState(null),[U,I]=o.useState(null),[x,N]=o.useState(!1),B=o.useRef(""),[g,M]=o.useState([]),Q=o.useRef(g),[K,E]=o.useState(!1);o.useState(!1);const[G,T]=o.useState(!1),[l,W]=o.useState(!1),[d,f]=o.useState(null),[F,Y]=o.useState(null),[h,L]=o.useState([]),_=o.useRef(h),[V,y]=o.useState(!1),[C,$]=o.useState(null),[H,w]=o.useState(C!=null&&C.IsStop?1:0),[P,z]=o.useState({columns:te.empty(),rows:te.empty()}),[le,ce]=o.useState(!1),[Oe,Ce]=o.useState(!0),[qt,Ie]=o.useState(!1);o.useState(!1),Ve();const Ne="TEST_ACCESS_KEY";o.useEffect(()=>{const e=localStorage.getItem("detailsStateStockOutFiFo");Ie(e==="open")},[]);const ye=e=>{try{let r=e.replace(/-/g,"+").replace(/_/g,"/");const i=r.length%4===0?"":"=".repeat(4-r.length%4);return r+i}catch{throw new Error("Invalid Base64 URL")}},we=e=>{try{const r=ye(e),q=fe.AES.decrypt(r,Ne).toString(fe.enc.Utf8);return JSON.parse(q)}catch{return u("/u/warehouse/material/stock-out-request"),null}},ue=async e=>{try{ce(!0);const r=await ht(e);M((r==null?void 0:r.data)||[])}catch{M([])}finally{ce(!1)}};o.useEffect(()=>{if(p){const e=we(p);e&&($(e),ue(e==null?void 0:e.OutReqSeq))}},[p]);const De=o.useCallback((e,r)=>{var O,s;const i=(O=e==null?void 0:e.LotNoFull)==null?void 0:O.trim().toLowerCase(),q=(s=e==null?void 0:e.Barcode)==null?void 0:s.trim().toLowerCase();L(S=>{if(!S.some(A=>{var J,Z;return((J=A.LotNoFull)==null?void 0:J.trim().toLowerCase())===i&&((Z=A.Barcode)==null?void 0:Z.trim().toLowerCase())===q})){const A=[...S,{OutReqSeq:e==null?void 0:e.OutReqSeq,OutReqItemSerl:e==null?void 0:e.OutReqItemSerl,WorkOrderSeq:e==null?void 0:e.WorkOrderSeq,WorkOrderSerl:e==null?void 0:e.WorkOrderSerl,FactUnit:e==null?void 0:e.FactUnit,FactUnitName:e==null?void 0:e.FactUnitName,InWHSeq:e==null?void 0:e.InWHSeq,InWHName:e==null?void 0:e.InWHName,OutWHSeq:e==null?void 0:e.OutWHSeq,OutWHName:e==null?void 0:e.OutWHName,ItemSeq:e==null?void 0:e.ItemSeq,UnitSeq:e==null?void 0:e.UnitSeq,ItemNo:e==null?void 0:e.ItemNo,LotNo:e==null?void 0:e.LotNo,Qty:e==null?void 0:e.Qty,DateCode:e==null?void 0:e.DateCode,ReelNo:e==null?void 0:e.ReelNo,Barcode:e==null?void 0:e.Barcode,StockOutDate:e==null?void 0:e.StockOutDate,LotNoFull:e==null?void 0:e.LotNoFull,ReqQty:e==null?void 0:e.ReqQty,EmpSeq:e==null?void 0:e.EmpSeq}];return r(),A}return S})},[]),me=o.useCallback(e=>{const r=Q.current,i=_.current;m.current.postMessage({type:"CHECK_BARCODE",barcode:e,tableData:r,tableScanHistory:i})},[]);o.useEffect(()=>{const e=O=>{if(O.key==="Enter"&&B.current.trim()){const s=B.current.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9/-]/g,"");me(s),v(s),B.current=""}else if(O.key.length===1){const s=O.key.normalize("NFD").replace(/[\u0300-\u036f]/g,"");/^[a-zA-Z0-9/-]$/.test(s)&&(B.current+=s)}},r=()=>y(!0),i=()=>y(!1),q=()=>y(!0);return window.addEventListener("keypress",e),window.addEventListener("focus",r),window.addEventListener("blur",i),document.addEventListener("click",q),()=>{window.removeEventListener("keypress",e),window.removeEventListener("focus",r),window.removeEventListener("blur",i),document.removeEventListener("click",q)}},[]);const se=o.useCallback(Je.debounce(async(e,r)=>{const i=await ft(e);if(i.success){const q=i.data[0];ie.success(r),b(null),E(!1),v(null),De(q,()=>{M(O=>O.map(s=>s.ItemNo===e.ItemNo?{...s,OutQty:s.OutQty+e.Qty,RemainQty:s.RemainQty-e.Qty}:s))})}else E(!0),f(i==null?void 0:i.message)},100),[]);o.useEffect(()=>(m.current=new Worker(new URL("/assets/workeStockOutFiFo-DVmTYmS-.js",import.meta.url)),m.current.onmessage=async e=>{const{success:r,message:i,data:q}=e.data;if(r){if(q){const{itemNo:O,qty:s,lot:S,dc:j,reel:A,barcode:J,UnitSeq:Z,ItemSeq:Be,OutWHName:Me,OutWHSeq:Le,InWHName:$e,InWHSeq:Ae,FactUnitName:Ue,FactUnit:He,WorkOrderSerl:Qe,WorkOrderSeq:_e,OutReqItemSerl:Pe,OutReqSeq:ze}=q;se({WorkingTag:"A",Idx_no:"1",Status:"0",DataSeq:"1",Selected:"1",OutReqSeq:ze,OutReqItemSerl:Pe,WorkOrderSeq:_e,WorkOrderSerl:Qe,FactUnit:He,FactUnitName:Ue,InWHSeq:Ae,InWHName:$e,OutWHSeq:Le,OutWHName:Me,ItemSeq:Be,UnitSeq:Z,ItemNo:O,LotNo:S,Qty:s,DateCode:j,ReelNo:A,Barcode:J},i)}}else E(!0),f(i)},()=>{m.current.terminate(),se.cancel()}),[C,se]),o.useEffect(()=>{Q.current=g,_.current=h},[g,h]);const Ee=e=>`
          <DataBlock1>
              <WorkingTag>A</WorkingTag>
              <IDX_NO>1</IDX_NO>
              <Status>0</Status>
              <DataSeq>1</DataSeq>
              <Selected>1</Selected>
              <TABLE_NAME>DataBlock1</TABLE_NAME>
              <IsChangedMst>1</IsChangedMst>
              <FactUnit>${e.FactUnit}</FactUnit>
              <Date>${e.StockOutDate}</Date>
              <ServiceSeq>3032</ServiceSeq>
              <MethodSeq>2</MethodSeq>
              <DtlUnitSeq>1</DtlUnitSeq>
          </DataBlock1>
      `,We=(e,r)=>`
  <DataBlock2>
   <WorkingTag>A</WorkingTag>
    <IDX_NO>${r+1}</IDX_NO>
    <DataSeq>${r+1}</DataSeq>
    <Status>0</Status>
    <Selected>0</Selected>
    <ItemSeq>${e.ItemSeq}</ItemSeq>
    <FactUnit>${e.FactUnit}</FactUnit>
    <TABLE_NAME>DataBlock2</TABLE_NAME>
    <FactUnitOld>1</FactUnitOld>
    <DateOld>${e.StockOutDate}</DateOld>
    <ServiceSeq>3032</ServiceSeq>
    <MethodSeq>2</MethodSeq>
    <Date>${e.StockOutDate}</Date>
  </DataBlock2>
`,je=e=>`
        <DataBlock1>
            <WorkingTag>A</WorkingTag>
    <IDX_NO>1</IDX_NO>
    <Status>0</Status>
    <DataSeq>1</DataSeq>
    <Selected>1</Selected>
    <TABLE_NAME>DataBlock1</TABLE_NAME>
    <IsChangedMst>1</IsChangedMst>
    <UseType>6044001</UseType>
    <IsOutSide>0</IsOutSide>
    <OutWHSeq />
    <InWHSeq>${e.InWHSeq}</InWHSeq>
    <MatOutSeq>0</MatOutSeq>
    <FactUnit>${e.FactUnit}</FactUnit>
    <MatOutNo />
    <MatOutDate>${e.StockOutDate}</MatOutDate>
    <EmpSeq>${e.EmpSeq}</EmpSeq>
    <MatOutType />
    <Remark />
        </DataBlock1>
    `,Fe=(e,r)=>`
  <DataBlock3>
   <WorkingTag>A</WorkingTag>
     <IDX_NO>${r+1}</IDX_NO>
    <DataSeq>${r+1}</DataSeq>
    <Status>0</Status>
    <Selected>0</Selected>
    <ReqQty>${e.ReqQty}</ReqQty>
    <Qty>${e.Qty}</Qty>
    <StdUnitQty>0</StdUnitQty>
    <Remark />
    <ItemLotNo>${e.LotNoFull}</ItemLotNo>
    <SerialNoFrom />
    <MatOutSeq></MatOutSeq>
    <OutItemSerl>0</OutItemSerl>
    <ItemSeq>${e.ItemSeq}</ItemSeq>
    <OutWHSeq>${e.OutWHSeq}</OutWHSeq>
    <InWHSeq>${e.InWHSeq}</InWHSeq>
    <UnitSeq>${e.UnitSeq}</UnitSeq>
    <WorkOrderSeq>${e.WorkOrderSeq}</WorkOrderSeq>
    <ConsgnmtCustSeq>0</ConsgnmtCustSeq>
    <OutReqSeq>${e.OutReqSeq}</OutReqSeq>
    <OutReqItemSerl>${e.OutReqItemSerl}</OutReqItemSerl>
    <PJTSeq>0</PJTSeq>
    <WBSSeq>0</WBSSeq>
    <WorkOrderSerl>${e.WorkOrderSerl}</WorkOrderSerl>
    <AlterRate>0</AlterRate>
    <TABLE_NAME>DataBlock3</TABLE_NAME>
  </DataBlock3>
`,be=o.useCallback(async e=>{if(!Oe)return;if(e.preventDefault(),N(!0),I(null),T(!0),Ce(!1),h.length===0){N(!1),E(!0),T(!1),I(null),f("Chưa có dữ liệu để gửi. Vui lòng quét dữ liệu trước khi gửi.");return}const r=Ee(h[0]),i=h.map(We).join(`
`),q=je(h[0]),O=h.map(Fe).join(`
`);try{const s=await St(H,C==null?void 0:C.OutReqSeq,h,{xmlSCOMCloseCheckWEB:r,xmlSCOMCloseItemCheckWEB:i,xmlSPDMMOutProcCheckWEB:q,xmlSPDMMOutProcItemCheckWEB:O});I(s),s.success?(u("/u/warehouse/material/stock-out-request"),T(!1),W(!0),Y("Tất cả các dữ liệu đã được thực thi thành công!"),de(),L([])):(T(!1),E(!0),f(s.message))}catch(s){T(!1),I({error:s.message}),E(!0),f(s.message)}finally{N(!1)}},[C,h,H]),de=o.useCallback(async e=>{if(h.length===0){E(!0),f("Không có dữ liệu để reset! Vui lòng quét dữ liệu trước.");return}const r=h.map(i=>({ItemSeq:i==null?void 0:i.ItemSeq,ItemLotNo:i==null?void 0:i.LotNoFull}));Se(r).then(()=>{L([]),ue(g==null?void 0:g.OutReqSeq),ie.success("Reset form thành công!")}).catch(i=>{ie.error("Đã xảy ra lỗi khi reset form!")})},[h,g==null?void 0:g.OutReqSeq]),Te=()=>{const e=P.rows.items;let r=[];return e.forEach(i=>{const q=i[0],O=i[1]-1;for(let s=q;s<=O;s++)r.push(s)}),r},ve=o.useCallback(async e=>{e.preventDefault();const r=Te();if(r.length===0){E(!0),f("Vui lòng chọn ít nhất một hàng để xóa.");return}if(h.length===0){E(!0),f("Không có dữ liệu nào để xóa.");return}const i=r.map(s=>{var S,j;return{ItemNo:(S=h[s])==null?void 0:S.ItemNo,Qty:(j=h[s])==null?void 0:j.Qty}}),q=r.map(s=>{var S,j;return{ItemSeq:(S=h[s])==null?void 0:S.ItemSeq,ItemLotNo:(j=h[s])==null?void 0:j.LotNoFull}}),O=h.filter((s,S)=>!r.includes(S));Se(q),L(O),M(s=>s.map(S=>{const j=i.find(A=>A.ItemNo===S.ItemNo);return j?{...S,OutQty:S.OutQty-j.Qty,RemainQty:S.RemainQty+j.Qty}:S}))},[h,P,M]);return t.jsxs(t.Fragment,{children:[t.jsx(Ze,{children:t.jsxs("title",{children:["ITM - ",c("Stock Out Request")]})}),t.jsxs("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:[t.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[t.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx(xt,{level:4,className:"mt-2 uppercase opacity-85 ",children:c("Stock Out FIFO")}),t.jsx(it,{status:V,handleSubmit:be,handleRestFrom:de,handleDelete:ve})]}),t.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[t.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[t.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[t.jsx(at,{}),c("Giá trị")]}),t.jsx("span",{className:"relative size-5 shrink-0",children:t.jsx(tt,{})})]}),t.jsx("div",{className:"flex p-2 gap-4",children:t.jsx(ct,{filteredData:C,handleCheckBarcode:me,inputBarCode:X,setInputBarCode:b,setCheckValueIsStop:w})})]})]}),t.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg",children:t.jsx(dt,{sampleTableA:g,sampleTableB:h,setSelection:z,selection:P})})]}),t.jsx(st,{modal2Open:K,setModal2Open:E,error:d}),t.jsx(rt,{setModal4Open:T,modal4Open:G}),t.jsx(lt,{setModal5Open:W,modal5Open:l,successMessage:F})]})]})}export{Bt as default};

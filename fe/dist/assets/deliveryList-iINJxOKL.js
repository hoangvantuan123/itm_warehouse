import{j as e,B as V,R as ne,r as s,u as te,C as X,G as l,D as ie,H as re,a as ce,E as W,F as A,b as oe,c as Q,d as Z,I as de,S as ue,e as me,f as ee,l as pe,g as xe,T as he,s as U,h as fe}from"./index-Bnb57sCX.js";import{A as ye}from"./index-CPHTBLOx.js";import{R as Se}from"./SaveOutlined-CS-qQl8S.js";import{R as ge}from"./moment-KDbgG_ZS.js";import{G as Ce}from"./getCodeHelpCombo-D7Z_TyW-.js";import{C as De}from"./index-BTOq29qs.js";import{R as Ne}from"./FilterOutlined-B-epXwC3.js";function ke({fetchData:m,nextPageStockIn:x,isAPISuccess:r}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{type:"default",icon:e.jsx(Se,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:x,children:"STOCK IN (IQC)"},"Reset"),e.jsx(V,{type:"primary",icon:e.jsx(ne,{}),size:"middle",className:"uppercase",onClick:m,children:"SEARCH"},"Save")]})}function ve({data:m,onCellClicked:x,gridData:r,setGridData:g}){const[c,h]=s.useState(!1),N=s.useCallback(()=>h(!1),[]),{t:k}=te(),[o,v]=s.useState({columns:X.empty(),rows:X.empty()}),C=s.useMemo(()=>[{title:k("4179")},{title:"DelvMngNo"},{title:"ImpType"},{title:"TotalQty"},{title:"OkQty"},{title:"RemainQty"},{title:"DelvDate"},{title:"CustSeq"},{title:"CustNm"},{title:"DomOrImp"},{title:"PurchaseType"},{title:"BizUnitName"},{title:"BizUnit"},{title:"EmpSeq"},{title:"EmpName"},{title:"DeptSeq"},{title:"DeptName"},{title:"CurrSeq"},{title:"CurrName"},{title:"ExRate"}],[]),[d,n]=s.useState(C),j=s.useCallback((i,T)=>{const f=d.indexOf(i);if(f!==-1){const y={...i,width:T},D=[...d];D.splice(f,1,y),n(D)}},[d]),L=s.useCallback(([i,T])=>{const f=r[T]||{},{DelvNo:y="",DelvMngNo:D="",ImpType:G="",TotalQty:M="",OkQty:$="",RemainQty:q="",DelvDate:w="",CustSeq:z="",CustNm:J="",DomOrImp:O="",PurchaseType:b="",BizUnitName:_="",BizUnit:R="",EmpSeq:S="",EmpName:E="",DeptSeq:B="",DeptName:P="",CurrSeq:I="",CurrName:H="",ExRate:K=""}=f,t=u=>u!=null?String(u):"",p={0:{kind:l.Text,data:t(y)},1:{kind:l.Text,data:t(D)},2:{kind:l.Text,data:t(G)},3:{kind:l.Text,data:t(M)},4:{kind:l.Text,data:t($)},5:{kind:l.Text,data:t(q)},6:{kind:l.Text,data:t(w)},7:{kind:l.Text,data:t(z)},8:{kind:l.Text,data:t(J)},9:{kind:l.Text,data:t(O)},10:{kind:l.Text,data:t(b)},11:{kind:l.Text,data:t(_)},12:{kind:l.Text,data:t(R)},13:{kind:l.Text,data:t(S)},14:{kind:l.Text,data:t(E)},15:{kind:l.Text,data:t(B)},16:{kind:l.Text,data:t(P)},17:{kind:l.Text,data:t(I)},18:{kind:l.Text,data:t(H)},19:{kind:l.Text,data:t(K)}};if(p.hasOwnProperty(i)){const{kind:u,data:a}=p[i];return{kind:u,data:a,displayData:a}}return{kind:l.Text,data:"",displayData:""}},[r]),[F,Y]=s.useState(void 0);return s.useCallback(i=>{console.log("cell",i),Y(i)},[]),s.useEffect(()=>{g(m)},[m]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(ge,{}),"DATA SHEET"]}),e.jsx(ie,{columns:d,getCellContent:L,rows:r.length,showSearch:c,getCellsForSelection:!0,onSearchClose:N,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:j,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:x,rowSelect:"single",gridSelection:o,onGridSelectionChange:v,getRowThemeOverride:i=>i%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const je=async(m,x,r,g)=>{try{const c=`${re}/mssql/deliverry-list/itm-sug-get-active-delivery-web`,h=await ce.get(c,{params:{fromDate:m,toDate:x,deliveryNo:r,delivbizUniteryNo:g},headers:{"Content-Type":"application/json"}});return h.status===200?{success:!0,data:h.data.data}:{success:!1,message:W.ERROR}}catch(c){return{success:!1,message:c.response?c.response.data.message:W.ERROR}}};function Te({formData:m,setFormData:x,setDeliveryNo:r,setToDate:g,toDate:c,deliveryNo:h,bizUnit:N,setBizUnit:k,dataUnit:o}){const v=n=>{x(n)},C=n=>{g(n)},d=n=>{k(n)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{layout:"vertical",children:e.jsxs(oe,{className:"gap-4 flex items-center ",children:[e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 1"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:m,onChange:v})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 2"}),className:"mb-0",children:e.jsx(Z,{className:"w-full text-sm p-2",value:c,onChange:C,format:"YYYY-MM-DD"})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Delivery No"}),className:"mb-0",children:e.jsx(de,{placeholder:"",value:h,size:"small",onChange:n=>r(n.target.value),className:" text-sm p-2"})})}),e.jsx(Q,{children:e.jsx(A.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(ue,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:d,options:o==null?void 0:o.map(n=>({label:n==null?void 0:n.AccUnitName,value:n==null?void 0:n.BizUnit}))})})})]})})})}const{Title:we,Text:Oe}=he;function Be({permissions:m,isMobile:x}){s.useRef(null);const r=me(),[g,c]=s.useState(!1),[h,N]=s.useState(!1),[k,o]=s.useState([]),[v,C]=s.useState([]),[d,n]=s.useState(ee().startOf("month")),[j,L]=s.useState(ee()),[F,Y]=s.useState(""),[i,T]=s.useState(4);s.useState(null);const[f,y]=s.useState(null),[D,G]=s.useState(!1),M=s.useCallback(t=>t.format("YYYYMMDD"),[]),[$,q]=s.useState(!1),[w,z]=s.useState(null),[J,O]=s.useState(null);s.useState([]);const[b,_]=s.useState([]),[R,S]=s.useState(!0),{t:E}=te(),B=async()=>{if(!R)return;c(!0),S(!1);let t;try{t=U.loading("Đang tải dữ liệu, vui lòng chờ...",0);const p=await je(d?M(d):"",j?M(j):"",F,i);p!=null&&p.success?(o(p.data||[]),U.success("Tải dữ liệu thành công!"),S(!0)):(o([]),S(!0),U.error("Có lỗi xảy ra khi tải dữ liệu."))}catch{o([]),S(!0),U.error("Có lỗi xảy ra khi tải dữ liệu.")}finally{t&&t(),S(!0),c(!1)}};s.useEffect(()=>{B()},[]);const P=s.useCallback(async()=>{N(!0);try{const t=await Ce("",6,10003,1,"%","","","","");C((t==null?void 0:t.data)||[])}catch{C([])}finally{N(!1)}},[]),I=s.useMemo(()=>pe.debounce(P,100),[P]),H=s.useCallback(()=>{f&&r(`/u/warehouse/material/waiting-iqc-stock-in/${f}`)},[f,r]),K=(t,p)=>{let u;if(t[0]===-1){if(t[0]===-1?(u=t[1],q(!0)):(u=t[0],q(!1)),w&&w[0]===t[0]&&w[1]===t[1]){y(null),z(null),O(null);return}if(u>=0&&u<b.length){const a=b[u],se={DelvNo:a.DelvNo,DelvMngNo:a.DelvMngNo,ImpType:a.ImpType,TotalQty:a.TotalQty,OkQty:a.OkQty,RemainQty:a.RemainQty,DelvDate:a.DelvDate,CustSeq:a.CustSeq,CustNm:a.CustNm,DomOrImp:a.DomOrImp,PurchaseType:a.PurchaseType,BizUnitName:a.BizUnitName,BizUnit:a.BizUnit,EmpSeq:a.EmpSeq,EmpName:a.EmpName,DeptSeq:a.DeptSeq,DeptName:a.DeptName,CurrSeq:a.CurrSeq,CurrName:a.CurrName,ExRate:a.ExRate},ae=De.AES.encrypt(JSON.stringify(se),"TEST_ACCESS_KEY").toString();if(R){const le=fe(ae);y(le),O(a),z(t)}}}};return s.useEffect(()=>(I(),()=>{I.cancel()}),[I]),e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs("title",{children:["ITM - ",E("Delivery List")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{level:4,className:"mt-2 uppercase opacity-85 ",children:E("Delivery List")}),e.jsx(ke,{fetchData:B,nextPageStockIn:H,isAPISuccess:R})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(Ne,{}),E("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(ye,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(Te,{formData:d,setFormData:n,setDeliveryNo:Y,setToDate:L,toDate:j,deliveryNo:F,bizUnit:i,setBizUnit:T,dataUnit:v})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(ve,{data:k,setCheckedPath:G,checkedPath:D,setKeyPath:y,loading:h,setData:o,onCellClicked:K,setGridData:_,gridData:b})})]})})]})}export{Be as default};

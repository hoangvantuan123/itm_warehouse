import{r as s,_ as ee,$ as se,a0 as X,a as Q,E as q,j as e,a1 as h,a2 as te,a3 as ae,B as L,a4 as ne,R as re,s as A,G as v,D as oe,F as B,b as le,c as G,I as K,u as ce,e as ie,f as V,C as Y,l as de,g as ue,T as me}from"./index-BRdHSrU3.js";import{A as fe}from"./index-BZXw2AV1.js";import"./index-BEDMd2lo.js";import{a as pe}from"./tokenService-BioOSVnB.js";import{R as he,u as N,F as z,w as xe}from"./FileSaver.min-BYw5LDRN.js";import{R as J}from"./FileTextOutlined-BWpvRVAX.js";import{R as ge}from"./SaveOutlined-i11tk4Wt.js";import{R as ye}from"./DeleteOutlined-BKKxyFYc.js";import{R as je}from"./FileDoneOutlined-D3fa00T_.js";import{R as Se}from"./moment-eCcSryaS.js";import{R as we}from"./FilterOutlined-C28rl2Mj.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},ke=function(a,t){return s.createElement(ee,se({},a,{ref:t,icon:ve}))},be=s.forwardRef(ke);const Re=async(l,a)=>{try{const t=`${X}/mssql/system-users/itm-roles-data-users-web`,i=await Q.get(t,{params:{userId:l,userName:a},headers:{"Content-Type":"application/json"}});return i.status===200?{success:!0,data:i.data.data}:{success:!1,message:q.ERROR}}catch(t){return{success:!1,message:t.response?t.response.data.message:q.ERROR}}},Ie=async l=>{try{const a=pe(),t=await Q.post(`${X}/acc/admin/update-passwords-2`,{userIds:l},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});return t.status===200||t.status===201?{success:!0,message:t.data.message||"Operation successful",data:t.data}:{success:!1,message:`Unexpected status code: ${t.status}`}}catch(a){return{success:!1,message:a.response?a.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}};function Ne({handleSearch:l,handleUpdatePassUsers:a,data:t}){s.useState(!1);const i=()=>{const o=N.json_to_sheet(t),d=N.sheet_to_csv(o),n=new Blob([d],{type:"text/csv;charset=utf-8;"});z.saveAs(n,"rootmenu.csv")},m=()=>{const o=N.json_to_sheet(t),d=N.book_new();N.book_append_sheet(d,o,"Sheet1");const n=xe(d,{bookType:"xlsx",type:"array"}),I=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});z.saveAs(I,"rootmenu.xlsx")},f=()=>{const o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});z.saveAs(o,"rootmenu.json")},C=o=>{switch(o.key){case"csv":i();break;case"excel":m();break;case"json":f();break;case"updatePass":a();break;default:A.info("Chức năng này đang phát triển")}},R=e.jsxs(h,{onClick:C,className:"w-auto",children:[e.jsxs(h.SubMenu,{title:"Export",children:[e.jsx(h.Item,{icon:e.jsx(J,{}),children:"CSV Export"},"csv"),e.jsx(h.Item,{icon:e.jsx(he,{}),children:"Excel Export"},"excel"),e.jsx(h.Item,{icon:e.jsx(J,{}),children:"JSON Export"},"json")]},"export"),e.jsx(h.Item,{icon:e.jsx(te,{}),children:"Đặt lại mật khẩu mặc định"},"updatePass"),e.jsx(h.Item,{icon:e.jsx(ge,{}),children:"Lưu trữ"},"lutru"),e.jsx(h.Item,{icon:e.jsx(be,{}),children:"Bỏ lưu trữ"},"bolutru"),e.jsx(h.Item,{icon:e.jsx(ye,{}),danger:!0,children:"Xóa"},"delete")]});return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{overlay:R,children:e.jsxs(L,{children:["Actions ",e.jsx(ne,{})]})}),e.jsx(L,{icon:e.jsx(je,{}),size:"middle",className:"uppercase",type:"default",children:"Open"},"Reset"),e.jsx(L,{type:"primary",icon:e.jsx(re,{}),size:"middle",onClick:l,className:"uppercase",children:"SEARCH"},"Save")]})}function Ce({data:l,setSelection:a,selection:t,showSearch:i,setShowSearch:m}){const[f,C]=s.useState([]),R=s.useCallback(()=>m(!1),[]);s.useState(null),s.useState([]),s.useState(!1),s.useState(null);const o=s.useCallback(c=>{},[]);s.useRef({cell:null,time:0});const d=s.useMemo(()=>[{title:"UserSeq"},{title:"UserName"},{title:"UserId"},{title:"DeptSeq"},{title:"Remark"},{title:"LoginDate"},{title:"LoginStatus"}],[]),[n,I]=s.useState(d),k=s.useCallback((c,x)=>{const g=n.indexOf(c);if(g!==-1){const y={...c,width:x},j=[...n];j.splice(g,1,y),I(j)}},[n]),O=s.useCallback(([c,x])=>{const g=f[x]||{},{UserSeq:y="",UserName:j="",UserId:b="",DeptSeq:_="",Remark:P="",LoginDate:E="",LoginStatus:U}=g,u=w=>w!=null?String(w):"",S={0:{kind:v.Text,data:u(y),readonly:!1},1:{kind:v.Text,data:u(j),readonly:!1},2:{kind:v.Text,data:u(b),readonly:!1},3:{kind:v.Text,data:u(_),readonly:!1},4:{kind:v.Text,data:u(P),readonly:!1},5:{kind:v.Text,data:u(E),readonly:!1},6:{kind:v.Text,data:u(U),readonly:!0}};if(S.hasOwnProperty(c)){const{kind:w,data:T,readonly:D}=S[c];return{kind:w,data:T,displayData:T,readonly:D,allowOverlay:!D}}return{kind:v.Text,data:"",displayData:"",readonly:!0,allowOverlay:!1}},[f]);s.useState(void 0),s.useEffect(()=>{C(l)},[l]);const H=s.useCallback((c,x)=>{if(x.kind!=="Text")return;const g=["UserSeq","UserName","UserId","DeptSeq","Remark","LoginDate","LoginStatus"],[y,j]=c,b=g[y];f[j][b]=x.gridData,console.log("key",b)},[]);return e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs  border-b font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(Se,{}),"DATA SHEET"]}),e.jsx(oe,{columns:n,getCellContent:O,rows:f.length,showSearch:i,getCellsForSelection:!0,onSearchClose:R,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:k,onCellEdited:H,smoothScrollY:!0,smoothScrollX:!0,rowSelect:"multi",gridSelection:t,onCellActivated:o,onGridSelectionChange:a,getRowThemeOverride:c=>c%2===0?void 0:{bgCell:"#FBFBFB"},onPaste:!0,fillHandle:!0,keybindings:{downFill:!0,rightFill:!0},trailingRowOptions:{sticky:!0,tint:!0,hint:"New row..."}})]})})}function Ee({setUserName:l,userName:a,setUserId:t,userId:i}){return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(B,{layout:"vertical",children:e.jsxs(le,{className:"gap-4 flex items-center ",children:[e.jsx(G,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-xs",children:"Họ và Tên"}),className:"mb-0",children:e.jsx(K,{value:a,size:"small",onChange:m=>l(m.target.value),className:" text-sm p-2"})})}),e.jsx(G,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-xs",children:"Mã nhân viên"}),className:"mb-0",children:e.jsx(K,{value:i,size:"small",onChange:m=>t(m.target.value),className:" text-sm p-2"})})})]})})})}const{Title:Ue,Text:ze}=me;function He({permissions:l,isMobile:a}){const{t}=ce(),i=s.useRef(null);ie(),s.useState("");const[m,f]=s.useState(!1),[C,R]=s.useState(!1);s.useState(!1);const[o,d]=s.useState([]);s.useState(V().startOf("month")),s.useState(V());const[n,I]=s.useState(""),[k,O]=s.useState(""),[H,c]=s.useState(null),[x,g]=s.useState(!1),[y,j]=s.useState(!1),[b,_]=s.useState({columns:Y.empty(),rows:Y.empty()}),[P,E]=s.useState(!1);s.useCallback(r=>r.format("YYYYMMDD"),[]);const[U,u]=s.useState(!0),S=s.useCallback(async()=>{f(!0);try{const r=await Re(n,k);d((r==null?void 0:r.data)||[])}catch{d([])}finally{f(!1)}},[n,k]),w=s.useMemo(()=>de.debounce(S,300),[S]),T=()=>{j(!0),S()};s.useEffect(()=>{!n&&!k&&S()},[S,n,k]),s.useEffect(()=>(y&&w(),()=>{w.cancel()}),[w,y]);const D=()=>{const r=b.rows.items;let p=[];return r.forEach(M=>{const $=M[0],Z=M[1]-1;for(let F=$;F<=Z;F++)p.push(F)}),p},W=async()=>{if(!U)return;u(!1),R(!0);const r=A.loading("Updating passwords...",0);try{const M=D().map($=>o[$].UserId);await Ie(M),r(),A.success("Passwords updated successfully!")}catch{r(),A.error("Failed to update passwords. Please try again.")}finally{u(!0),R(!1)}};return s.useEffect(()=>{const r=p=>{(p.ctrlKey||p.metaKey)&&p.key==="f"&&(p.preventDefault(),E(!0))};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsxs("title",{children:["ITM - ",t("User Management")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ue,{level:4,className:"mt-2 uppercase opacity-85 ",children:t("USER MANAGEMENT")}),e.jsx(Ne,{handleSearch:T,handleUpdatePassUsers:W,data:o,isAPISuccess:U})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(we,{}),t("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(fe,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(Ee,{setUserId:I,userId:n,setUserName:O,userName:k})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg overflow-auto",children:e.jsx(Ce,{data:o,setCheckedPath:g,checkedPath:x,setKeyPath:c,loading:m,gridRef:i,setData:d,setSelection:_,selection:b,showSearch:P,setShowSearch:E})})]})})]})}export{He as default};

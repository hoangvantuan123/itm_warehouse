import{j as e,B as J,R as se,r as t,H as ae,a as le,F as R,b as ne,C as Q,I as ie,u as re,c as oe,d as ce,T as de,e as me}from"./index-CH1Hwwgx.js";import{A as ue}from"./index-UcH0C-KJ.js";import{d as V}from"./dayjs.min-CcT_u-J9.js";import{R as pe}from"./SaveOutlined-CbfFRCAs.js";import{C as X,G as n,D as xe,a as he}from"./index-DOW1G361.js";import{R as fe}from"./TableOutlined-DyNz5-WS.js";import{D as W,G as ye,s as D}from"./getCodeHelpCombo-aa2G8fCH.js";import{E as Z}from"./constants-BUjU6TAr.js";import"./moment-CKpJ3YZT.js";import{S as ge}from"./index-wrMrSeEs.js";import{l as De}from"./lodash-mC-ok4mC.js";import"./vi-Bbl5sAuU.js";import{R as Ce}from"./FilterOutlined-CuCXCfZZ.js";import"./DownOutlined-Cd5RM64i.js";function Se({fetchData:u,nextPageStockIn:p}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{type:"default",icon:e.jsx(pe,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:p,children:"STOCK IN (IQC)"},"Reset"),e.jsx(J,{type:"primary",icon:e.jsx(se,{}),size:"middle",className:"uppercase",onClick:u,children:"SEARCH"},"Save")]})}function Ne({data:u,onCellClicked:p,gridData:o,setGridData:x}){const[d,c]=t.useState(!1),E=t.useCallback(()=>c(!1),[]),[f,y]=t.useState({columns:X.empty(),rows:X.empty()}),C=t.useMemo(()=>[{title:"DelvNo"},{title:"DelvMngNo"},{title:"ImpType"},{title:"TotalQty"},{title:"OkQty"},{title:"RemainQty"},{title:"DelvDate"},{title:"CustSeq"},{title:"CustNm"},{title:"DomOrImp"},{title:"PurchaseType"},{title:"BizUnitName"},{title:"BizUnit"},{title:"EmpSeq"},{title:"EmpName"},{title:"DeptSeq"},{title:"DeptName"},{title:"CurrSeq"},{title:"CurrName"},{title:"ExRate"}],[]),[m,k]=t.useState(C),i=t.useCallback((r,v)=>{const h=m.indexOf(r);if(h!==-1){const g={...r,width:v},S=[...m];S.splice(h,1,g),k(S)}},[m]),U=t.useCallback(([r,v])=>{const h=o[v]||{},{DelvNo:g="",DelvMngNo:S="",ImpType:L="",TotalQty:I="",OkQty:K="",RemainQty:q="",DelvDate:j="",CustSeq:z="",CustNm:$="",DomOrImp:M="",PurchaseType:T="",BizUnitName:Y="",BizUnit:O="",EmpSeq:A="",EmpName:B="",DeptSeq:w="",DeptName:G="",CurrSeq:_="",CurrName:l="",ExRate:b=""}=h,s=N=>N!=null?String(N):"",a={0:{kind:n.Text,data:s(g)},1:{kind:n.Text,data:s(S)},2:{kind:n.Text,data:s(L)},3:{kind:n.Text,data:s(I)},4:{kind:n.Text,data:s(K)},5:{kind:n.Text,data:s(q)},6:{kind:n.Text,data:s(j)},7:{kind:n.Text,data:s(z)},8:{kind:n.Text,data:s($)},9:{kind:n.Text,data:s(M)},10:{kind:n.Text,data:s(T)},11:{kind:n.Text,data:s(Y)},12:{kind:n.Text,data:s(O)},13:{kind:n.Text,data:s(A)},14:{kind:n.Text,data:s(B)},15:{kind:n.Text,data:s(w)},16:{kind:n.Text,data:s(G)},17:{kind:n.Text,data:s(_)},18:{kind:n.Text,data:s(l)},19:{kind:n.Text,data:s(b)}};if(a.hasOwnProperty(r)){const{kind:N,data:H}=a[r];return{kind:N,data:H,displayData:H}}return{kind:n.Text,data:"",displayData:""}},[o]),[P,F]=t.useState(void 0);return t.useCallback(r=>{console.log("cell",r),F(r)},[]),t.useEffect(()=>{x(u)},[u]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(fe,{}),"DATA SHEET"]}),e.jsx(xe,{columns:m,getCellContent:U,rows:o.length,showSearch:d,getCellsForSelection:!0,onSearchClose:E,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:i,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:p,rowSelect:"single",gridSelection:f,onGridSelectionChange:y,getRowThemeOverride:r=>r%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const ke=async(u,p,o,x)=>{try{const d=`${ae}/mssql/deliverry-list/itm-sug-get-active-delivery-web`,c=await le.get(d,{params:{fromDate:u,toDate:p,deliveryNo:o,delivbizUniteryNo:x},headers:{"Content-Type":"application/json"}});return c.status===200?{success:!0,data:c.data.data}:{success:!1,message:Z.ERROR}}catch(d){return{success:!1,message:d.response?d.response.data.message:Z.ERROR}}};function ve({formData:u,setFormData:p,setDeliveryNo:o,setToDate:x,toDate:d,deliveryNo:c,bizUnit:E,setBizUnit:f,dataUnit:y}){const C=i=>{p(i)},m=i=>{x(i)},k=i=>{f(i)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(R,{layout:"vertical",children:e.jsxs(ne,{className:"gap-4 flex items-center ",children:[e.jsx(Q,{children:e.jsx(R.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 1"}),className:"mb-0",children:e.jsx(W,{className:"w-full text-sm p-2",value:u,onChange:C})})}),e.jsx(Q,{children:e.jsx(R.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Date 2"}),className:"mb-0",children:e.jsx(W,{className:"w-full text-sm p-2",value:d,onChange:m,format:"YYYY-MM-DD"})})}),e.jsx(Q,{children:e.jsx(R.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Delivery No"}),className:"mb-0",children:e.jsx(ie,{placeholder:"",value:c,size:"small",onChange:i=>o(i.target.value),className:" text-sm p-2"})})}),e.jsx(Q,{children:e.jsx(R.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(ge,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:k,options:y==null?void 0:y.map(i=>({label:i==null?void 0:i.AccUnitName,value:i==null?void 0:i.BizUnit}))})})})]})})})}const{Title:je,Text:Pe}=de;function Fe({permissions:u,isMobile:p}){const{t:o}=re();t.useRef(null);const x=oe(),[d,c]=t.useState(!1),[E,f]=t.useState([]),[y,C]=t.useState([]),[m,k]=t.useState(V().startOf("month")),[i,U]=t.useState(V()),[P,F]=t.useState(""),[r,v]=t.useState(4);t.useState(null);const[h,g]=t.useState(null),[S,L]=t.useState(!1),I=t.useCallback(l=>l.format("YYYYMMDD"),[]),[K,q]=t.useState(!1),[j,z]=t.useState(null),[$,M]=t.useState(null);t.useState([]);const[T,Y]=t.useState([]);let O;const A=async()=>{c(!0),O&&D.destroy(),O=D.info({message:"Đang tải dữ liệu",description:"Dữ liệu đang được tải.",duration:0});try{const l=await ke(m?I(m):"",i?I(i):"",P,r),b=(l==null?void 0:l.data)||[];f(b),D.destroy(),b.length>0?D.success({message:"Thành công",description:"Dữ liệu đã được tải thành công."}):D.success({message:"Thành công",description:"Không có dữ liệu phù hợp được tìm thấy."})}catch{f([]),D.destroy(),D.error({message:"Lỗi",description:"Có lỗi xảy ra khi tải dữ liệu."})}finally{c(!1)}},B=t.useCallback(async()=>{c(!0);try{const l=await ye("",6,10003,1,"%","","","","");C((l==null?void 0:l.data)||[])}catch{C([])}finally{c(!1)}},[]),w=t.useMemo(()=>De.debounce(B,100),[B]),G=t.useCallback(()=>{h&&x(`/u/warehouse/material/waiting-iqc-stock-in/${h}`)},[h,x]),_=(l,b)=>{let s;if(l[0]===-1){if(l[0]===-1?(s=l[1],q(!0)):(s=l[0],q(!1)),j&&j[0]===l[0]&&j[1]===l[1]){g(null),z(null),M(null);return}if(s>=0&&s<T.length){const a=T[s],N={DelvNo:a.DelvNo,DelvMngNo:a.DelvMngNo,ImpType:a.ImpType,TotalQty:a.TotalQty,OkQty:a.OkQty,RemainQty:a.RemainQty,DelvDate:a.DelvDate,CustSeq:a.CustSeq,CustNm:a.CustNm,DomOrImp:a.DomOrImp,PurchaseType:a.PurchaseType,BizUnitName:a.BizUnitName,BizUnit:a.BizUnit,EmpSeq:a.EmpSeq,EmpName:a.EmpName,DeptSeq:a.DeptSeq,DeptName:a.DeptName,CurrSeq:a.CurrSeq,CurrName:a.CurrName,ExRate:a.ExRate},ee=he.AES.encrypt(JSON.stringify(N),"TEST_ACCESS_KEY").toString(),te=me(ee);g(te),M(a),z(l)}}};return t.useEffect(()=>{A()},[]),t.useEffect(()=>(w(),()=>{w.cancel()}),[w]),e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs("title",{children:["ITM - ",o("Delivery List")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(je,{level:4,className:"mt-2 uppercase opacity-85 ",children:o("Delivery List")}),e.jsx(Se,{fetchData:A,nextPageStockIn:G})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(Ce,{}),o("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(ue,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(ve,{formData:m,setFormData:k,setDeliveryNo:F,setToDate:U,toDate:i,deliveryNo:P,bizUnit:r,setBizUnit:v,dataUnit:y})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(Ne,{data:E,setCheckedPath:L,checkedPath:S,setKeyPath:g,loading:d,setData:f,onCellClicked:_,setGridData:Y,gridData:T})})]})})]})}export{Fe as default};

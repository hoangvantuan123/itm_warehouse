import{j as e,B as te,R as ie,r as t,C as se,G as n,D as de,H as ue,a as me,E as ae,F as N,b as xe,c as R,d as le,I as V,S as pe,u as he,e as fe,f as ne,l as Se,g as ge,T as Ne,s as _,h as Ce}from"./index-ayyTO2Yu.js";import{A as je}from"./index-D2oIM98g.js";import{R as Ie}from"./SaveOutlined-Bl2C5slq.js";import{R as ke}from"./moment-Csjzis2u.js";import{G as ye}from"./getCodeHelpCombo-NItWnzqA.js";import{C as be}from"./index-CelGP5ee.js";import{R as Te}from"./FilterOutlined-CWq-eo3k.js";import"./tokenService-CcOQ_w6w.js";function we({fetchData:i,nextPageStockIn:x}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{type:"default",icon:e.jsx(Ie,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},onClick:x,children:"MATERIAL WH STOCK IN"},"Reset"),e.jsx(te,{type:"primary",icon:e.jsx(ie,{}),size:"middle",className:"uppercase",onClick:i,children:"SEARCH"},"Save")]})}function De({data:i,onCellClicked:x,gridData:r,setGridData:p,loading:v}){const[h,d]=t.useState(!1),u=t.useCallback(()=>d(!1),[]);t.useState([!1,!1,!1]);const[f,S]=t.useState({columns:se.empty(),rows:se.empty()}),E=t.useMemo(()=>[{title:"IsPass"},{title:"IsNG"},{title:"BLSeq"},{title:"BLSerl"},{title:"TestEndDate"},{title:"QCNo"},{title:"BLDate"},{title:"BLNo"},{title:"ItemName"},{title:"ItemNo"},{title:"Spec"},{title:"ItemSeq"},{title:"Qty"},{title:"OKQty"},{title:"RealSampleQty"},{title:"SMTestResultName"},{title:"Remark"},{title:"Memo1"},{title:"Memo2"},{title:"WHName"}],[]),[m,C]=t.useState(E),M=t.useCallback((c,I)=>{const k=m.indexOf(c);if(k!==-1){const y={...c,width:I},b=[...m];b.splice(k,1,y),C(b)}},[m]),j=t.useCallback(([c,I])=>{const k=r[I]||{},{IsPass:y="",IsNG:b="",BLSeq:P="",BLSerl:U="",TestEndDate:B="",QCNo:z="",BLDate:G="",BLNo:X="",ItemName:q="",ItemNo:Q="",Spec:F="",ItemSeq:Z="",Qty:K="",OKQty:A="",RealSampleQty:$="",SMTestResultName:ee="",Remark:W="",Memo1:J="",Memo2:T="",WHName:H=""}=k,a=D=>D!=null?String(D):"",w={0:{kind:n.Boolean,data:y},1:{kind:n.Boolean,data:b},2:{kind:n.Text,data:a(P)},3:{kind:n.Text,data:a(U)},4:{kind:n.Text,data:a(B)},5:{kind:n.Text,data:a(z)},6:{kind:n.Text,data:a(G)},7:{kind:n.Text,data:a(X)},8:{kind:n.Text,data:a(q)},9:{kind:n.Text,data:a(Q)},10:{kind:n.Text,data:a(F)},11:{kind:n.Text,data:a(Z)},12:{kind:n.Text,data:a(K)},13:{kind:n.Text,data:a(A)},14:{kind:n.Text,data:a($)},15:{kind:n.Text,data:a(ee)},16:{kind:n.Text,data:a(W)},17:{kind:n.Text,data:a(J)},18:{kind:n.Text,data:a(T)},19:{kind:n.Text,data:a(H)}};if(w.hasOwnProperty(c)){const{kind:D,data:Y}=w[c];return{kind:D,data:Y,displayData:Y}}return{kind:"",data:"",displayData:""}},[r]),[O,s]=t.useState(void 0);return t.useCallback(c=>{console.log("cell",c),s(c)},[]),t.useEffect(()=>{p(i)},[i]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8  overflow-hidden",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(ke,{}),"DATA SHEET"]}),e.jsx(de,{columns:m,getCellContent:j,rows:r.length,showSearch:h,getCellsForSelection:!0,onSearchClose:u,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:M,smoothScrollY:!0,smoothScrollX:!0,rowSelect:"single",onCellClicked:x,gridSelection:f,onGridSelectionChange:S,getRowThemeOverride:c=>c%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}const Re=async(i,x,r,p,v,h)=>{try{const d=`${ue}/mssql/iqc-status/itm-spdqc-imp-result-list-web`,u=await me.get(d,{params:{fromDate:i,toDate:x,blNo:r,delivbizUniteryNo:p,itemNo:v,itemName:h},headers:{"Content-Type":"application/json"}});return u.status===200?{success:!0,data:u.data.data}:{success:!1,message:ae.ERROR}}catch(d){return{success:!1,message:d.response?d.response.data.message:ae.ERROR}}};function ve({formData:i,setFormData:x,setBLNo:r,setToDate:p,toDate:v,blNo:h,bizUnit:d,setBizUnit:u,dataUnit:f,setItemNo:S,itemNo:E,setItemName:m,itemName:C}){const M=s=>{x(s)},j=s=>{p(s)},O=s=>{u(s)};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(N,{layout:"vertical",children:e.jsxs(xe,{className:"gap-4 flex items-center ",children:[e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"From Date"}),className:"mb-0",children:e.jsx(le,{className:"w-full text-sm p-2",value:i,onChange:M})})}),e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"To Date"}),className:"mb-0",children:e.jsx(le,{className:"w-full text-sm p-2",value:v,onChange:j,format:"YYYY-MM-DD"})})}),e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"BL No"}),className:"mb-0",children:e.jsx(V,{placeholder:"Input placeholder",value:h,size:"small",onChange:s=>r(s.target.value),className:" text-sm p-2"})})}),e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Item No"}),className:"mb-0",children:e.jsx(V,{placeholder:"Input placeholder",value:E,size:"small",onChange:s=>S(s.target.value),className:" text-sm p-2"})})}),e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Item Name"}),className:"mb-0",children:e.jsx(V,{placeholder:"Input placeholder",value:C,size:"small",onChange:s=>m(s.target.value),className:" text-sm p-2"})})}),e.jsx(R,{children:e.jsx(N.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Acc Unit"}),className:"mb-0",children:e.jsx(pe,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:190},onChange:O,options:[{label:"All",value:"0"},...(f==null?void 0:f.map(s=>({label:s==null?void 0:s.AccUnitName,value:s==null?void 0:s.BizUnit})))||[]]})})})]})})})}const{Title:Ee,Text:qe}=Ne;function Fe({permissions:i,isMobile:x}){const{t:r}=he();t.useRef(null);const p=fe(),[v,h]=t.useState(!1),[d,u]=t.useState(!1),[f,S]=t.useState([]),[E,m]=t.useState([]),[C,M]=t.useState(ne().startOf("month")),[j,O]=t.useState(ne()),[s,c]=t.useState(""),[I,k]=t.useState(""),[y,b]=t.useState(""),[P,U]=t.useState(0);t.useState(null);const[B,z]=t.useState(null);t.useState(!1);const G=t.useCallback(o=>o.format("YYYYMMDD"),[]),[X,q]=t.useState(!1),[Q,F]=t.useState(null),[Z,K]=t.useState(null);t.useState([]);const[A,$]=t.useState([]),[ee,W]=t.useState(!1),[J,T]=t.useState(!0);t.useEffect(()=>{const o=localStorage.getItem("detailsStateDelist");W(o==="open")},[]);const H=async()=>{if(J===!1){_.warning("Không thể thực hiện, vui lòng kiểm tra trạng thái.");return}T(!1),h(!0);const o=_.loading("Đang tải dữ liệu, vui lòng chờ...",0);try{const L=await Re(G(C),G(j),s,P,I,y),g=(L==null?void 0:L.data)||[];S(g),T(!0),o(),_.success("Tải dữ liệu thành công!")}catch{S([]),T(!0),o(),notification.destroy(),_.error("Có lỗi xảy ra khi tải dữ liệu.")}finally{T(!0),h(!1)}},a=t.useCallback(async()=>{u(!0);try{const o=await ye("",6,10003,1,"%","","","","");m((o==null?void 0:o.data)||[])}catch{m([])}finally{u(!1)}},[]),w=t.useMemo(()=>Se.debounce(a,100),[a]),D=t.useCallback(()=>{B&&p(`/u/warehouse/material/material-wh-stock-in/${B}`)},[B,p]),Y=(o,L)=>{let g;if(o[0]===-1){if(o[0]===-1?(g=o[1],q(!0)):(g=o[0],q(!1)),Q&&Q[0]===o[0]&&Q[1]===o[1]){z(null),F(null),K(null);return}if(g>=0&&g<A.length){const l=A[g],oe={IsPass:l.IsPass,IsNG:l.IsNG,BLSeq:l.BLSeq,BLSerl:l.BLSerl,TestEndDate:l.TestEndDate,QCNo:l.QCNo,BLDate:l.BLDate,BLNo:l.BLNo,ItemName:l.ItemName,ItemNo:l.ItemNo,Spec:l.Spec,ItemSeq:l.ItemSeq,Qty:l.Qty,OKQty:l.OKQty,RealSampleQty:l.RealSampleQty,SMTestResultName:l.SMTestResultName,Remark:l.Remark,Memo1:l.Memo1,Memo2:l.Memo2},ce=be.AES.encrypt(JSON.stringify(oe),"TEST_ACCESS_KEY").toString(),re=Ce(ce);z(re),K(l),F(o)}}};return t.useEffect(()=>{H()},[]),t.useEffect(()=>(w(),()=>{w.cancel()}),[w]),e.jsxs(e.Fragment,{children:[e.jsx(ge,{children:e.jsxs("title",{children:["ITM - ",r("IQC Status")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{level:4,className:"mt-2 uppercase opacity-85 ",children:r("IQC Status")}),e.jsx(we,{fetchData:H,nextPageStockIn:D})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(Te,{}),r("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(je,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(ve,{formData:C,setFormData:M,setBLNo:c,setToDate:O,toDate:j,blNo:s,bizUnit:P,setBizUnit:U,dataUnit:E,setItemNo:k,itemNo:I,setItemName:b,itemName:y})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg",children:e.jsx(De,{data:f,loading:d,setData:S,onCellClicked:Y,setGridData:$,gridData:A})})]})})]})}export{Fe as default};

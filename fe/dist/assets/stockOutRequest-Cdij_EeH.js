import{j as e,F as B,b as vt,c as $,d as ot,S as G,I as L,B as Q,R as Ne,r as t,C as A,G as s,D as ke,M as Me,a as rt,H as dt,E as it,u as Tt,e as qt,f as ct,l as Dt,g as Rt,T as It,s as Re,h as Pt}from"./index-BsuSr-eI.js";import{A as Ce}from"./index-C2VfIzH1.js";import{G as Ie,s as Mt}from"./getCodeHelpCombo-7nPhYYim.js";import{C as Ot}from"./index-twXuxses.js";import{R as Et}from"./moment-CUVyRcS3.js";import{R as Ut}from"./FileDoneOutlined-C97TOu0U.js";import{R as ye}from"./FilterOutlined-DIHE_GDp.js";import{M as At}from"./modalWaiting-Bp3uP3JU.js";function zt({formData:l,setFormData:r,setToDate:b,toDate:y,dataUnit:h,setBizUnit:C,handleSearch1:I,handleSearch2:T,handleSearch3:j,minorName:N,setFactUnit:p,setProgStatus:q,minorName2:w,setUseType:P,deptName:M,empName:D,custName:n,prodPlanNo:m,setProdPlanNo:d,setWorkOrderNo:k,workOrderNo:i,prodReqNo:R,setProdReqNo:O,outReqNo:S,setOutReqNo:u,setDeptName:c,setDeptSeq:g,resetTable:v,setEmpName:U,setEmpSeq:E,resetTable2:V,setCustSeq:W,setCustName:Y,resetTable3:de}){const J=a=>{r(a)},K=a=>{b(a)},X=a=>{p(a)},ue=a=>{q(a)},Z=a=>{P(a)},ae=a=>{c(a.target.value),g(""),v()},le=a=>{U(a.target.value),E(""),V()},me=a=>{Y(a.target.value),W(""),de()};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(B,{layout:"vertical",onKeyDown:a=>{a.key==="Enter"&&a.preventDefault()},children:e.jsxs(vt,{className:"gap-4 flex items-center ",children:[e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Ngày yêu cầu 1"}),className:"mb-0",children:e.jsx(ot,{className:"w-full text-sm p-2",value:l,onChange:J,format:"YYYY-MM-DD"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Ngày yêu cầu 2"}),className:"mb-0",children:e.jsx(ot,{className:"w-full text-sm p-2",value:y,onChange:K,format:"YYYY-MM-DD"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Nơi sản xuất"}),className:"mb-0",children:e.jsx(G,{defaultValue:"",size:"large",style:{width:190},allowClear:!0,onChange:X,options:[{label:"All",value:""},...(h==null?void 0:h.map(a=>({label:a==null?void 0:a.AccUnitName,value:a==null?void 0:a.FactUnit})))||[]]})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Bộ phận yêu cầu"}),className:"mb-0",children:e.jsx(L,{size:"small",className:" text-sm p-2 bg-blue-50",onKeyDown:a=>{a.key==="Enter"&&I()},value:M,onChange:ae,onDoubleClick:I})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Người yêu cầu"}),className:"mb-0",children:e.jsx(L,{size:"small",className:" text-sm p-2 bg-blue-50",onKeyDown:a=>{a.key==="Enter"&&T()},value:D,onChange:le,onDoubleClick:T})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Khách hàng"}),className:"mb-0",children:e.jsx(L,{size:"small",className:" text-sm p-2 bg-blue-50",onKeyDown:a=>{a.key==="Enter"&&j()},value:n,onChange:me,onDoubleClick:j})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Số yêu cầu"}),className:"mb-0",children:e.jsx(L,{value:S,onChange:a=>u(a.target.value),size:"small",className:" text-sm p-2"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Số kế hoạch"}),className:"mb-0",children:e.jsx(L,{value:m,onChange:a=>d(a.target.value),size:"small",className:" text-sm p-2"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Số lệnh sản xuất"}),className:"mb-0",children:e.jsx(L,{value:i,onChange:a=>k(a.target.value),size:"small",className:" text-sm p-2"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Số yêu cầu sản xuất"}),className:"mb-0",children:e.jsx(L,{value:R,onChange:a=>O(a.target.value),size:"small",className:" text-sm p-2"})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Phân loại kho"}),className:"mb-0",children:e.jsx(G,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:240},allowClear:!0,onChange:Z,options:[{label:"All",value:""},...(w==null?void 0:w.map(a=>({label:a==null?void 0:a.MinorName,value:a==null?void 0:a.Value})))||[]]})})}),e.jsx($,{children:e.jsx(B.Item,{label:e.jsx("span",{className:"uppercase text-[10px]",children:"Trạng thái"}),className:"mb-0",children:e.jsx(G,{id:"typeSelect",defaultValue:"All",size:"large",style:{width:240},allowClear:!0,onChange:ue,options:[{label:"All",value:""},...(N==null?void 0:N.map(a=>({label:a==null?void 0:a.MinorName,value:a==null?void 0:a.Value})))||[]]})})})]})})})}function Bt({nextPage:l,debouncedFetchSPDMMOutReqListQueryWeb:r}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{type:"default",icon:e.jsx(Ut,{}),size:"middle",className:"uppercase",color:"default",variant:"filled",onClick:l,style:{backgroundColor:"#f0f0f0",borderColor:"#d9d9d9"},children:"XỬ LÝ XUẤT KHO"},"Reset"),e.jsx(Q,{type:"primary",icon:e.jsx(Ne,{}),size:"middle",onClick:r,className:"uppercase",children:"SEARCH"},"Save")]})}function Ft({data:l,onCellClicked:r,gridData:b,setGridData:y,loading:h}){const[C,I]=t.useState(!1),T=t.useCallback(()=>I(!1),[]);t.useState([!1,!1,!1]);const[j,N]=t.useState({columns:A.empty(),rows:A.empty()}),p=t.useMemo(()=>[{title:"IsStop"},{title:"IsConfirm"},{title:"FactUnitName"},{title:"ReqDate"},{title:"OutReqNo"},{title:"DeptName"},{title:"EmpName"},{title:"CustName"},{title:"UseTypeName"},{title:"WorkOrderNo"},{title:"AssyItemName"},{title:"AssyItemNo"},{title:"AssyItemSpec"},{title:"AssyUnitName"},{title:"ProcName"},{title:"AssyQty"},{title:"AssyProgQty"},{title:"ItemName"},{title:"ItemNo"},{title:"ItemSpec"},{title:"UnitName"},{title:"Qty"},{title:"ProgQty"},{title:"IsReturn"},{title:"Remark"},{title:"ItemSeq"},{title:"ItemUnitSeq"},{title:"AssyItemSeq"},{title:"PJTSeq"},{title:"WBSSeq"},{title:"FactUnit"},{title:"OutReqSeq"},{title:"UseType"},{title:"OSPPOSeq"},{title:"ProgStatus"},{title:"ProgStatusName"},{title:"ProdPlanNo"},{title:"ProdPlanSeq"},{title:"ProdReqNo"}],[]),[q,w]=t.useState(p),P=t.useCallback((m,d)=>{const k=q.indexOf(m);if(k!==-1){const i={...m,width:d},R=[...q];R.splice(k,1,i),w(R)}},[q]),M=t.useCallback(([m,d])=>{const k=b[d]||{},{IsStop:i="",IsConfirm:R="",FactUnitName:O="",ReqDate:S="",OutReqNo:u="",DeptName:c="",EmpName:g="",CustName:v="",UseTypeName:U="",WorkOrderNo:E="",AssyItemName:V="",AssyItemNo:W="",AssyItemSpec:Y="",AssyUnitName:de="",ProcName:J="",AssyQty:K="",AssyProgQty:X="",ItemName:ue="",ItemNo:Z="",ItemSpec:ae="",UnitName:le="",Qty:me="",ProgQty:a="",IsReturn:xe="",Remark:ne="",ItemSeq:je="",ItemUnitSeq:oe="",AssyItemSeq:be="",PJTSeq:he="",WBSSeq:we="",FactUnit:pe="",OutReqSeq:Se="",UseType:ie="",OSPPOSeq:ve="",ProgStatus:fe="",ProgStatusName:ee="",ProdPlanNo:ce="",ProdPlanSeq:_="",ProdReqNo:re=""}=k,o=F=>F!=null?String(F):"",te={0:{kind:s.Boolean,data:i},1:{kind:s.Boolean,data:R},2:{kind:s.Text,data:o(O)},3:{kind:s.Text,data:o(S)},4:{kind:s.Text,data:o(u)},5:{kind:s.Text,data:o(c)},6:{kind:s.Text,data:o(g)},7:{kind:s.Text,data:o(v)},8:{kind:s.Text,data:o(U)},9:{kind:s.Text,data:o(E)},10:{kind:s.Text,data:o(V)},11:{kind:s.Text,data:o(W)},12:{kind:s.Text,data:o(Y)},13:{kind:s.Text,data:o(de)},14:{kind:s.Text,data:o(J)},15:{kind:s.Text,data:o(K)},16:{kind:s.Text,data:o(X)},17:{kind:s.Text,data:o(ue)},18:{kind:s.Text,data:o(Z)},19:{kind:s.Text,data:o(ae)},20:{kind:s.Text,data:o(le)},21:{kind:s.Text,data:o(me)},22:{kind:s.Text,data:o(a)},23:{kind:s.Boolean,data:xe},24:{kind:s.Text,data:o(ne)},25:{kind:s.Text,data:o(je)},26:{kind:s.Text,data:o(oe)},27:{kind:s.Text,data:o(be)},28:{kind:s.Text,data:o(he)},29:{kind:s.Text,data:o(we)},30:{kind:s.Text,data:o(pe)},31:{kind:s.Text,data:o(Se)},32:{kind:s.Text,data:o(ie)},33:{kind:s.Text,data:o(ve)},34:{kind:s.Text,data:o(fe)},35:{kind:s.Text,data:o(ee)},36:{kind:s.Text,data:o(ce)},37:{kind:s.Text,data:o(_)},38:{kind:s.Text,data:o(re)}};if(te.hasOwnProperty(m)){const{kind:F,data:se}=te[m];return{kind:F,data:se,displayData:se}}return{kind:"",data:"",displayData:""}},[b]),[D,n]=t.useState(void 0);return t.useCallback(m=>{console.log("cell",m),n(m)},[]),t.useEffect(()=>{y(l)},[l]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8  overflow-hidden",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(Et,{}),"DATA SHEET"]}),e.jsx(ke,{columns:q,getCellContent:M,rows:b.length,showSearch:C,getCellsForSelection:!0,onSearchClose:T,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:P,smoothScrollY:!0,smoothScrollX:!0,rowSelect:"single",onCellClicked:r,gridSelection:j,onGridSelectionChange:N,getRowThemeOverride:m=>m%2===0?void 0:{bgCell:"#FBFBFB"}})]})})}function $t({data:l,onCellClicked:r,setSelection:b,selection:y}){const[h,C]=t.useState([]),[I,T]=t.useState(!1),j=t.useCallback(()=>T(!1),[]),N=t.useMemo(()=>[{title:"BeDeptName"},{title:"BeBegDate"},{title:"BeEndDate"},{title:"DeptRemark"}],[]),[p,q]=t.useState(N),w=t.useCallback((n,m)=>{const d=p.indexOf(n);if(d!==-1){const k={...n,width:m},i=[...p];i.splice(d,1,k),q(i)}},[p]),P=t.useCallback(([n,m])=>{const d=h[m]||{},{BeDeptName:k="",BeBegDate:i="",BeEndDate:R="",DeptRemark:O=""}=d,S=c=>c!=null?String(c):"",u={0:{kind:s.Text,data:S(k)},1:{kind:s.Text,data:S(i)},2:{kind:s.Text,data:S(R)},3:{kind:s.Text,data:S(O)}};if(u.hasOwnProperty(n)){const{kind:c,data:g}=u[n];return{kind:c,data:g,displayData:g}}return{kind:s.Text,data:"",displayData:""}},[h]),[M,D]=t.useState(void 0);return t.useCallback(n=>{D(n)},[]),t.useEffect(()=>{C(l)},[l]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsx("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:e.jsx(ke,{columns:p,getCellContent:P,rows:h.length,showSearch:I,getCellsForSelection:!0,onSearchClose:j,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:w,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:r,rowSelect:"single",gridSelection:y,onGridSelectionChange:b})})})}const{Search:Wt}=L;function Qt({setConditionSeq:l,data:r,modalVisible:b,setModalVisible:y,fetchCodehelpData1:h,handleSearch:C,setSubConditionSql:I,setDeptName:T,setDeptSeq:j,deptName:N,selection:p,setSelection:q,resetTable:w}){const[P,M]=t.useState(!1),[D,n]=t.useState(null),[m,d]=t.useState(null);t.useState(null);const k=u=>{l(u)},i=u=>{I(u)},R=(u,c)=>{let g;if(u[0]!==-1){console.log("onCellClicked");return}if(u[0]===-1?(g=u[1],M(!0)):(g=u[0],M(!1)),D&&D[0]===u[0]&&D[1]===u[1]){T(""),j(""),n(null),d(null);return}if(g>=0&&g<r.length){const v=r[g];T(v==null?void 0:v.BeDeptName),j(v==null?void 0:v.BeDeptSeq),d(v),n(u)}},O=()=>{y(!1),T(""),j(""),w()},S=u=>{T(u.target.value),j(""),w()};return e.jsx("div",{children:e.jsxs(Me,{open:b,width:"80%",maskClosable:!1,footer:null,closable:!1,style:{top:50},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"75vh"},className:"gap-4",children:[e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600",children:[e.jsx(ye,{}),"Điều kiện truy vấn"]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(Ce,{})})]}),e.jsxs("div",{className:"flex p-2 gap-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(G,{id:"typeSelect",defaultValue:"Bộ phận",style:{width:120},size:"middle",onChange:k,options:[{value:1,label:"Bộ phận"},{value:0,label:"Mã bộ phận"}]})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(G,{id:"typeSelect",defaultValue:"Sử dụng",style:{width:300},size:"middle",options:[{value:"IsUse = 1",label:"Sử dụng"},{value:"IsUse = 0",label:"Chưa sử dụng"}],onChange:i})}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(Wt,{allowClear:!0,size:"middle",placeholder:"Tìm kiếm",value:N,onKeyDown:u=>{u.key==="Enter"&&C()},onChange:S,className:" w-full"})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(Q,{type:"primary",icon:e.jsx(Ne,{}),size:"middle",onClick:h,children:"Truy vấn"})})]})]}),e.jsx($t,{data:r,onCellClicked:R,setSelection:q,selection:p})]}),e.jsxs("div",{className:"flex justify-end gap-4 ",children:[e.jsx(Q,{onClick:O,children:"Cancel"}),e.jsx(Q,{type:"primary",onClick:()=>y(!1),children:"Save"})]})]})})}function Vt({data:l,onCellClicked:r,setSelection:b,selection:y}){const[h,C]=t.useState([]),[I,T]=t.useState(!1),j=t.useCallback(()=>T(!1),[]),N=t.useMemo(()=>[{title:"EmpName"},{title:"EmpID"},{title:"DeptName"},{title:"WkDeptName"},{title:"UMJoName"},{title:"PosName"},{title:"UMJpName"},{title:"UMJdName"},{title:"TypeName"},{title:"SMSexName"}],[]),[p,q]=t.useState(N),w=t.useCallback((n,m)=>{const d=p.indexOf(n);if(d!==-1){const k={...n,width:m},i=[...p];i.splice(d,1,k),q(i)}},[p]),P=t.useCallback(([n,m])=>{const d=h[m]||{},{EmpName:k="",EmpID:i="",DeptName:R="",WkDeptName:O="",UMJoName:S="",PosName:u="",UMJpName:c="",UMJdName:g="",TypeName:v="",SMSexName:U=""}=d,E=W=>W!=null?String(W):"",V={0:{kind:s.Text,data:E(k)},1:{kind:s.Text,data:E(i)},2:{kind:s.Text,data:E(R)},3:{kind:s.Text,data:E(O)},4:{kind:s.Text,data:E(S)},5:{kind:s.Text,data:E(u)},6:{kind:s.Text,data:E(c)},7:{kind:s.Text,data:E(g)},8:{kind:s.Text,data:E(v)},9:{kind:s.Text,data:E(U)}};if(V.hasOwnProperty(n)){const{kind:W,data:Y}=V[n];return{kind:W,data:Y,displayData:Y}}return{kind:s.Text,data:"",displayData:""}},[h]),[M,D]=t.useState(void 0);return t.useCallback(n=>{console.log("cell",n),D(n)},[]),t.useEffect(()=>{C(l)},[l]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsx("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:e.jsx(ke,{columns:p,getCellContent:P,rows:h.length,showSearch:I,getCellsForSelection:!0,onSearchClose:j,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:w,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:r,rowSelect:"multi",gridSelection:y,onGridSelectionChange:b})})})}const{Search:Lt}=L;function Yt({setConditionSeq:l,data:r,modalVisible:b,setModalVisible:y,empName:h,handleSearch:C,setSubConditionSql:I,fetchCodehelpData2:T,setEmpSeq:j,setEmpName:N,setSelection:p,selection:q,resetTable:w}){const[P,M]=t.useState(!1),[D,n]=t.useState(null),[m,d]=t.useState(null);t.useState(null);const k=S=>{l(S)},i=(S,u)=>{let c;if(S[0]===-1){if(S[0]===-1?(c=S[1],M(!0)):(c=S[0],M(!1)),D&&D[0]===S[0]&&D[1]===S[1]){N(""),j(""),n(null),d(null);return}if(c>=0&&c<r.length){const g=r[c];N(g==null?void 0:g.EmpName),j(g==null?void 0:g.EmpSeq),d(g),n(S)}}},R=()=>{y(!1),N(""),j(""),w()},O=S=>{N(S.target.value),j(""),w()};return e.jsx("div",{children:e.jsxs(Me,{open:b,width:"80%",maskClosable:!1,footer:null,closable:!1,style:{top:50},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"75vh"},className:"gap-4",children:[e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600",children:[e.jsx(ye,{}),"Điều kiện truy vấn"]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(Ce,{})})]}),e.jsxs("div",{className:"flex p-2 gap-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(G,{id:"typeSelect",defaultValue:"Nhân viên",style:{width:180},size:"middle",options:[{value:1,label:"Nhân viên"},{value:2,label:"Mã nhân viên"}],onChange:k})}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(Lt,{allowClear:!0,size:"middle",placeholder:"Tìm kiếm",value:h,onKeyDown:S=>{S.key==="Enter"&&C()},onChange:O,className:" w-full"})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(Q,{type:"primary",icon:e.jsx(Ne,{}),size:"middle",onClick:T,children:"Truy vấn"})})]})]}),e.jsx(Vt,{data:r,onCellClicked:i,setSelection:p,selection:q})]}),e.jsxs("div",{className:"flex justify-end gap-4 ",children:[e.jsx(Q,{onClick:R,children:"Cancel"}),e.jsx(Q,{type:"primary",onClick:()=>y(!1),children:"Save"})]})]})})}function _t({data:l,onCellClicked:r,selection:b,setSelection:y}){const[h,C]=t.useState([]),[I,T]=t.useState(!1),j=t.useCallback(()=>T(!1),[]),N=t.useMemo(()=>[{title:"CustSeq"},{title:"FullName"},{title:"CustNo"},{title:"BizNo"},{title:"UMCustClassName"}],[]),[p,q]=t.useState(N),w=t.useCallback((n,m)=>{const d=p.indexOf(n);if(d!==-1){const k={...n,width:m},i=[...p];i.splice(d,1,k),q(i)}},[p]),P=t.useCallback(([n,m])=>{const d=h[m]||{},{CustSeq:k="",FullName:i="",CustNo:R="",BizNo:O="",UMCustClassName:S=""}=d,u=g=>g!=null?String(g):"",c={0:{kind:s.Text,data:u(k)},1:{kind:s.Text,data:u(i)},2:{kind:s.Text,data:u(R)},3:{kind:s.Text,data:u(O)},4:{kind:s.Text,data:u(S)}};if(c.hasOwnProperty(n)){const{kind:g,data:v}=c[n];return{kind:g,data:v,displayData:v}}return{kind:s.Text,data:"",displayData:""}},[h]),[M,D]=t.useState(void 0);return t.useCallback(n=>{console.log("cell",n),D(n)},[]),t.useEffect(()=>{C(l)},[l]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsx("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:e.jsx(ke,{columns:p,getCellContent:P,rows:h.length,showSearch:I,getCellsForSelection:!0,onSearchClose:j,width:"100%",height:"100%",rowMarkers:"both",useRef:t.useRef,onColumnResize:w,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:r,rowSelect:"multi",gridSelection:b,onGridSelectionChange:y})})})}const{Search:Kt}=L;function Ht({setConditionSeq:l,data:r,modalVisible:b,setModalVisible:y,setKeyword:h,keyword:C,handleSearch:I,setSubConditionSql:T,fetchCodehelpData3:j,setCustSeq:N,setCustName:p,custName:q,resetTable:w,setSelection:P,selection:M}){const[D,n]=t.useState(!1),[m,d]=t.useState(null),[k,i]=t.useState(null);t.useState(null);const R=c=>{l(c)},O=(c,g)=>{let v;if(c[0]===-1){if(c[0]===-1?(v=c[1],n(!0)):(v=c[0],n(!1)),m&&m[0]===c[0]&&m[1]===c[1]){p(""),N(""),d(null),i(null);return}if(v>=0&&v<r.length){const U=r[v];p(U==null?void 0:U.FullName),N(U==null?void 0:U.CustSeq),i(U),d(c)}}},S=()=>{y(!1),p(""),N(""),w()},u=c=>{p(c.target.value),N(""),w()};return e.jsx("div",{children:e.jsxs(Me,{open:b,width:"80%",maskClosable:!1,footer:null,closable:!1,style:{top:50},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"75vh"},className:"gap-4",children:[e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600",children:[e.jsx(ye,{}),"Điều kiện truy vấn"]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(Ce,{})})]}),e.jsxs("div",{className:"flex p-2 gap-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(G,{id:"typeSelect",defaultValue:"Điểm gia công bên ngoài",style:{width:220},size:"middle",options:[{value:1,label:"Điểm gia công bên ngoài"},{value:2,label:"Số đơn vị gia công"},{value:3,label:"Mã số kinh doanh"},{value:4,label:"Tương hiệu"}],onChange:R})}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(Kt,{allowClear:!0,size:"middle",placeholder:"Tìm kiếm",value:q,onKeyDown:c=>{c.key==="Enter"&&I()},onChange:u,className:" w-full"})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(Q,{type:"primary",icon:e.jsx(Ne,{}),size:"middle",onClick:j,children:"Truy vấn"})})]})]}),e.jsx(_t,{data:r,onCellClicked:O,setSelection:P,selection:M})]}),e.jsxs("div",{className:"flex justify-end gap-4 ",children:[e.jsx(Q,{onClick:S,children:"Cancel"}),e.jsx(Q,{type:"primary",onClick:()=>y(!1),children:"Save"})]})]})})}const Gt=l=>`
       <DataBlock1>
    <WorkingTag>A</WorkingTag>
    <IDX_NO>1</IDX_NO>
    <Status>0</Status>
    <DataSeq>1</DataSeq>
    <Selected>1</Selected>
    <TABLE_NAME>DataBlock1</TABLE_NAME>
    <IsChangedMst>${l.IsChangedMst}</IsChangedMst>
    <FactUnit>${l.FactUnit}</FactUnit>
    <ReqDate>${l.ReqDate}</ReqDate>
    <ReqDateTo>${l.ReqDateTo}</ReqDateTo>
    <OutReqNo>${l.OutReqNo}</OutReqNo>
    <UseType>${l.UseType}</UseType>
    <DeptSeq>${l.DeptSeq}</DeptSeq>
    <DeptName>${l.DeptName} </DeptName>
    <EmpSeq>${l.EmpSeq} </EmpSeq>
    <EmpName>${l.EmpName}</EmpName>
    <CustSeq>${l.CustSeq}</CustSeq>
    <CustName>${l.CustName}</CustName>
    <ProgStatus>${l.ProgStatus}</ProgStatus>
    <ProdPlanNo>${l.ProdPlanNo}</ProdPlanNo>
    <WorkOrderNo>${l.WorkOrderNo}</WorkOrderNo>
    <ProdReqNo>${l.ProdReqNo}</ProdReqNo>
  </DataBlock1>
    `,Jt={xmlFlags:2,serviceSeq:4594,workingTag:"",companySeq:1,languageSeq:6,userSeq:3106,pgmSeq:1036085},Xt=l=>{const r={...Jt,...l},y={xmlDocument:Gt(r),xmlFlags:r.xmlFlags,serviceSeq:r.serviceSeq,workingTag:r.workingTag,companySeq:r.companySeq,languageSeq:r.languageSeq,userSeq:r.userSeq,pgmSeq:r.pgmSeq};return rt.post(`${dt}/mssql/stock-out/sp-dmm-out-req-list`,y,{headers:{"Content-Type":"application/json"}}).then(h=>{if(h.status===200||h.status===201)return h.data;throw new Error("Error from API: "+h.data.message)}).catch(h=>{const C=h.response?h.response.data.message||"Error from API":"Unknown error occurred";throw new Error(C)})},Pe=async(l,r,b,y,h,C,I,T,j,N,p,q,w,P,M,D,n,m,d,k)=>{try{const i=`${dt}/mssql/code-help-query`,R=await rt.get(i,{params:{workingTag:l,languageSeq:r,codeHelpSeq:b,companySeq:y,keyword:h,param1:C,param2:I,param3:T,param4:j,conditionSeq:N,pageCount:p,pageSize:q,subConditionSql:w,accUnit:P,bizUnit:M,factUnit:D,deptSeq:n,wkDeptSeq:m,empSeq:d,userSeq:k},headers:{"Content-Type":"application/json"}});return R.status===200?{success:!0,data:R.data.data}:{success:!1,message:it.ERROR}}catch(i){return{success:!1,message:i.response?i.response.data.message:it.ERROR}}},{Title:Zt,Text:rs}=It;function ds({permissions:l,isMobile:r}){const{t:b}=Tt();t.useRef(null);const y=qt(),[h,C]=t.useState(!1),[I,T]=t.useState(null),[j,N]=t.useState(!1),[p,q]=t.useState([]),[w,P]=t.useState([]),[M,D]=t.useState([]),[n,m]=t.useState([]),[d,k]=t.useState(ct().startOf("month")||""),[i,R]=t.useState(ct()),[O,S]=t.useState(4),[u,c]=t.useState(""),[g,v]=t.useState(""),[U,E]=t.useState(""),[V,W]=t.useState(null),Y=t.useCallback(x=>x.format("YYYYMMDD"),""),[de,J]=t.useState(!1),[K,X]=t.useState(null),[ue,Z]=t.useState(null),[ae,le]=t.useState([]),[me,a]=t.useState(!1),[xe,ne]=t.useState(!1),[je,oe]=t.useState([]),[be,he]=t.useState([]),[we,pe]=t.useState([]),[Se,ie]=t.useState(!1),[ve,fe]=t.useState(!1),[ee,ce]=t.useState(!1),[_,re]=t.useState(1),[o,te]=t.useState(1),[F,se]=t.useState(""),[ge,Oe]=t.useState(""),[ut,Ee]=t.useState(""),[Ue,Ae]=t.useState(""),[mt,ze]=t.useState(""),[xt,Be]=t.useState(""),[Fe,$e]=t.useState(""),[We,ht]=t.useState(""),[Qe,pt]=t.useState(""),[Ve,St]=t.useState(""),[Le,ft]=t.useState(""),[gt,Te]=t.useState(!1),[Nt,Ye]=t.useState({columns:A.empty(),rows:A.empty()}),[kt,_e]=t.useState({columns:A.empty(),rows:A.empty()}),[Ct,Ke]=t.useState({columns:A.empty(),rows:A.empty()}),qe=()=>{Ye({columns:A.empty(),rows:A.empty()})},He=()=>{_e({columns:A.empty(),rows:A.empty()})},Ge=()=>{Ke({columns:A.empty(),rows:A.empty()})};t.useEffect(()=>{const x=localStorage.getItem("detailsStateStockOut");a(x==="open")},[]);const Je=async()=>{T(!0);const x=Re.loading("Đang tải dữ liệu, vui lòng chờ...",0);try{const H={IsChangedMst:"1",FactUnit:u,ReqDate:d?Y(d):"",ReqDateTo:i?Y(i):"",OutReqNo:Le,UseType:U,DeptName:"",DeptSeq:ut,EmpSeq:mt,EmpName:"",CustSeq:xt,CustName:"",ProgStatus:g,ProdPlanNo:We,WorkOrderNo:Qe,ProdReqNo:Ve},z=await Xt(H),f=(z==null?void 0:z.data)||[];q(f),x(),Re.success("Tải dữ liệu thành công!")}catch{N(!0),x(),Mt.destroy(),Re.error("Có lỗi xảy ra khi tải dữ liệu.")}finally{T(!1)}},Xe=t.useCallback(async()=>{C(!0);try{const x=await Pe("Q",6,10010,1,ge,"","","","",_,1,1e5,o,"1",0,0,0,0,0,18770);oe((x==null?void 0:x.data)||[])}catch{oe([])}finally{C(!1)}},[_,o,ge]),Ze=t.useCallback(async()=>{C(!0);try{const x=await Pe("Q",6,10009,1,F,"","","","",_,1,1e5,o,"1",0,0,0,0,0,18770);he((x==null?void 0:x.data)||[])}catch{he([])}finally{C(!1)}},[_,o,F]),et=t.useCallback(async()=>{C(!0);try{const x=await Pe("Q",6,17071,1,F,"","","","",_,1,1e5,"SMCustStatus=2004001","1",0,0,0,0,0,18770);pe((x==null?void 0:x.data)||[])}catch{pe([])}finally{C(!1)}},[_,o,F]),tt=t.useCallback(async()=>{C(!0);try{const[x,H,z]=await Promise.all([Ie("",6,60001,1,"%","","","",""),Ie("",6,19998,1,"%","6036","","",""),Ie("",6,19998,1,"%","6044","","","")]);P((x==null?void 0:x.data)||[]),D((H==null?void 0:H.data)||[]),m((z==null?void 0:z.data)||[])}catch{P([]),D([])}finally{C(!1)}},[]),De=t.useMemo(()=>Dt.debounce(tt,100),[tt]),yt=t.useCallback(()=>{V&&y(`/u/warehouse/material/stock-out-request/${V}`)},[V,y]),jt=(x,H)=>{let z;if(x[0]===-1){if(x[0]===-1?(z=x[1],J(!0)):(z=x[0],J(!1)),K&&K[0]===x[0]&&K[1]===x[1]){W(null),X(null),Z(null);return}if(z>=0&&z<p.length){const f=p[z],nt={IDX_NO:f.IDX_NO,EmpName:f.EmpName,FactUnit:f.FactUnit,FactUnitName:f.FactUnitName,IsConfirm:f.IsConfirm,IsReturn:f.IsReturn,IsStop:f.IsStop,ItemName:f.ItemName,ItemNo:f.ItemNo,ItemSeq:f.ItemSeq,ItemSpec:f.ItemSpec,ItemUnitSeq:f.ItemUnitSeq,OSPPOSeq:f.OSPPOSeq,OutReqNo:f.OutReqNo,OutReqSeq:f.OutReqSeq,PJTSeq:f.PJTSeq,ProdPlanSeq:f.ProdPlanSeq,ProdReqNo:f.ProdReqNo,ProgQty:f.ProgQty,ProgStatus:f.ProgStatus,ProgStatusName:f.ProgStatusName,Qty:f.Qty,Remark:f.Remark,ReqDate:f.ReqDate,UnitName:f.UnitName,UseType:f.UseType,UseTypeName:f.UseTypeName,WBSSeq:f.WBSSeq,WorkOrderNo:f.WorkOrderNo},bt=Ot.AES.encrypt(JSON.stringify(nt),"TEST_ACCESS_KEY").toString();if(nt.IsStop===!0)Te(!0);else{Te(!1);const wt=Pt(bt);W(wt),Z(f),X(x)}}}},st=async()=>{ce(!0),ne(!0),Xe()},at=async()=>{ce(!0),ie(!0),Ze()},lt=async()=>{ce(!0),fe(!0),et()};return t.useEffect(()=>(De(),()=>{De.cancel()}),[De]),t.useEffect(()=>{Je()},[]),e.jsxs(e.Fragment,{children:[e.jsx(Rt,{children:e.jsxs("title",{children:["ITM - ",b("Stock Out Request")]})}),e.jsx("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsxs("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Zt,{level:4,className:"mt-2 uppercase opacity-85 ",children:b("Stock Out Request")}),e.jsx(Bt,{nextPage:yt,debouncedFetchSPDMMOutReqListQueryWeb:Je})]}),e.jsxs("details",{className:"group p-2 [&_summary::-webkit-details-marker]:hidden border rounded-lg bg-white",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer items-center justify-between gap-1.5 text-gray-900",children:[e.jsxs("h2",{className:"text-xs font-medium flex items-center gap-2 text-blue-600 uppercase",children:[e.jsx(ye,{}),b("Điều kiện truy vấn")]}),e.jsx("span",{className:"relative size-5 shrink-0",children:e.jsx(Ce,{})})]}),e.jsx("div",{className:"flex p-2 gap-4",children:e.jsx(zt,{formData:d,setFormData:k,setToDate:R,toDate:i,dataUnit:w,setBizUnit:S,deptName:ge,setDeptName:Oe,setDeptSeq:Ee,handleSearch1:st,handleSearch2:at,handleSearch3:lt,setModalVisible1:ne,setModalVisible2:ie,loadingCodeHelp:ee,modalVisible1:xe,modalVisible2:Se,setMinorName:D,minorName:M,setFactUnit:c,setProgStatus:v,minorName2:n,setUseType:E,empName:Ue,custName:Fe,setProdPlanNo:ht,prodPlanNo:We,setWorkOrderNo:pt,workOrderNo:Qe,setProdReqNo:St,prodReqNo:Ve,setOutReqNo:ft,outReqNo:Le,resetTable:qe,setEmpName:Ae,setEmpSeq:ze,resetTable2:He,resetTable3:Ge,setCustName:$e,setCustSeq:Be})})]})]}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg",children:e.jsx(Ft,{data:p,loading:h,setData:q,onCellClicked:jt,setGridData:le,gridData:ae})})]})}),e.jsx(Qt,{setModalVisible:ne,modalVisible:xe,loadingCodeHelp:ee,handleSearch:st,data:je,setConditionSeq:re,setSubConditionSql:te,fetchCodehelpData1:Xe,keyword:F,setKeyword:se,setDeptSeq:Ee,setDeptName:Oe,deptName:ge,setData1:oe,setSelection:Ye,selection:Nt,resetTable:qe}),e.jsx(Yt,{setModalVisible:ie,modalVisible:Se,loadingCodeHelp:ee,handleSearch:at,data:be,setConditionSeq:re,setSubConditionSql:te,fetchCodehelpData2:Ze,keyword:F,setKeyword:se,setEmpName:Ae,setEmpSeq:ze,setSelection:_e,selection:kt,resetTable:He,empName:Ue}),e.jsx(Ht,{setModalVisible:fe,modalVisible:ve,loadingCodeHelp:ee,handleSearch:lt,data:we,setConditionSeq:re,setSubConditionSql:te,fetchCodehelpData3:et,keyword:F,setKeyword:se,setCustName:$e,setCustSeq:Be,resetTable:Ge,setSelection:Ke,selection:Ct,custName:Fe}),e.jsx(At,{modal2Open:gt,setModal2Open:Te,resetTable:qe,error:"Đơn hàng đã được hoàn thành"})]})}export{ds as default};

import{r as s,j as e,aI as M,aK as W,B as O,aL as Z,s as y,a as q,aH as Y,u as J,F as I,b as ee,C as _,I as K,T as P,c as se,d as te}from"./index-Bs9yWD0t.js";import{d as G}from"./dayjs.min-Dv7_HJOV.js";import{l as ne}from"./lodash-Ce-vbS9w.js";import{G as N,D as ae,C as H}from"./index-OBdMMgIc.js";import"./moment-C0yF_v6Q.js";import"./index-Dh2nLnxp.js";import{G as oe}from"./getRootMenu-DZ4Z818c.js";import{R as re,u as L,F as z,w as le}from"./FileSaver.min-frEM_d-I.js";import{R as V}from"./FileTextOutlined-De0ON5I0.js";import{R as ce}from"./DeleteOutlined-BXFM3QKl.js";import{R as ie}from"./DownOutlined-DarA9UQs.js";import{R as ue}from"./FileDoneOutlined-B7kzfAs5.js";import{a as U}from"./tokenService-DihmZYU2.js";import{D as de}from"./index-BGbAmcFH.js";import{R as me}from"./TableOutlined-Dem2elRe.js";function he({openModal:m,handleDeleteDataSheet:r,data:a}){s.useState(!1);const x=()=>{const l=L.json_to_sheet(a),p=L.sheet_to_csv(l),i=new Blob([p],{type:"text/csv;charset=utf-8;"});z.saveAs(i,"rootmenu.csv")},t=()=>{const l=L.json_to_sheet(a),p=L.book_new();L.book_append_sheet(p,l,"Sheet1");const i=le(p,{bookType:"xlsx",type:"array"}),S=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});z.saveAs(S,"rootmenu.xlsx")},n=()=>{const l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"});z.saveAs(l,"rootmenu.json")},u=l=>{switch(l.key){case"csv":x();break;case"excel":t();break;case"json":n();break;case"delete":r();break;default:y.info("Chức năng này đang phát triển")}},g=e.jsxs(M,{onClick:u,className:" w-40",children:[e.jsxs(M.SubMenu,{title:"Export",children:[e.jsx(M.Item,{icon:e.jsx(V,{}),children:"CSV Export"},"csv"),e.jsx(M.Item,{icon:e.jsx(re,{}),children:"Excel Export"},"excel"),e.jsx(M.Item,{icon:e.jsx(V,{}),children:"JSON Export"},"json")]},"export"),e.jsx(M.Item,{icon:e.jsx(ce,{}),danger:!0,children:"Xóa"},"delete")]});return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{overlay:g,children:e.jsxs(O,{children:["Actions ",e.jsx(ie,{})]})}),e.jsx(O,{icon:e.jsx(ue,{}),size:"middle",className:"uppercase",type:"default",children:"Open"},"Reset"),e.jsx(O,{type:"primary",icon:e.jsx(Z,{}),size:"middle",onClick:m,style:{backgroundColor:"#4F46E5",borderColor:"#4F46E5"},children:"ADD ROOT MENU"},"Save")]})}const pe=async(m,r,a,x)=>{try{const t=U(),n=await q.post(`${Y}/mssql/system-users/itm-root-menu`,{Label:m,Key:r,Icon:a,Link:x},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return n.status===200||n.status===201?{success:!0,message:n.data.message||"Operation successful",data:n.data}:{success:!1,message:`Unexpected status code: ${n.status}`}}catch(t){return{success:!1,message:t.response?t.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:fe}=P;function xe({isOpen:m,onClose:r,fetchDataRootMenus:a,menus:x}){const{t}=J(),n=JSON.parse(localStorage.getItem("userInfo"));n!=null&&n.login;const[u]=I.useForm();s.useState([]),s.useState(!0),s.useState(null),s.useState(0),s.useState(1),s.useState(10),s.useState(0);const g=async l=>{const{Label:p,Key:i,Icon:S,Link:b}=l;try{const f=await pe(p,i,S,b);f.success?(y.success(t("Tạo menu thành công")),a(),u.resetFields(),r()):y.error(f.message||t("Lỗi khi tạo menu"))}catch{y.error(t("Lỗi khi tạo menu"))}};return e.jsx(de,{title:e.jsx(fe,{level:5,children:t("Thêm Root Menu")}),open:m,closable:!1,width:600,extra:[e.jsx(O,{onClick:r,children:t("Hủy")},"cancel"),e.jsx(O,{type:"primary",className:" ml-2 border-gray-200  bg-indigo-600 text-white  shadow-sm text-sm",onClick:()=>u.submit(),children:t("Lưu")},"submit")],children:e.jsx(I,{form:u,layout:"vertical",onFinish:g,style:{textAlign:"left"},className:"w-full",children:e.jsxs(ee,{gutter:16,children:[e.jsx(_,{span:24,children:e.jsx(I.Item,{label:t("Tên Root Menu"),name:"Label",rules:[{required:!0,message:t("Vui lòng nhập tên  root menu hiển thị")}],children:e.jsx(K,{size:"large",placeholder:t("Nhập tên root menu hiển thị")})})}),e.jsx(_,{span:24,children:e.jsx(I.Item,{label:t("Key"),name:"Key",rules:[{required:!0,message:t("Vui lòng nhập Key")}],children:e.jsx(K,{size:"large",placeholder:t("Nhập key hiển thị")})})}),e.jsx(_,{span:24,children:e.jsx(I.Item,{label:t("Link"),name:"Link",children:e.jsx(K,{size:"large",placeholder:t("Nhập link")})})}),e.jsx(_,{span:24,children:e.jsx(I.Item,{label:t("Icon"),name:"Icon",children:e.jsx(K,{size:"large",placeholder:t("Nhập Icon HTML")})})})]})})})}function ge({data:m,onCellClicked:r,setSelection:a,selection:x,setShowSearch:t,showSearch:n}){const[u,g]=s.useState([]),l=s.useCallback(()=>t(!1),[]),p=s.useMemo(()=>[{title:"Key"},{title:"Label",width:300},{title:"Link",width:350},{title:"Icon"}],[]),[i,S]=s.useState(p),b=s.useCallback((h,j)=>{const k=i.indexOf(h);if(k!==-1){const T={...h,width:j},w=[...i];w.splice(k,1,T),S(w)}},[i]),f=s.useCallback(([h,j])=>{const k=u[j]||{},{Key:T="",Label:w="",Link:D="",Icon:C=""}=k,R=v=>v!=null?String(v):"",A={0:{kind:N.Text,data:R(T)},1:{kind:N.Text,data:R(w)},2:{kind:N.Text,data:R(D)},3:{kind:N.Text,data:R(C)}};if(A.hasOwnProperty(h)){const{kind:v,data:F}=A[h];return{kind:v,data:F,displayData:F}}return{kind:N.Text,data:"",displayData:""}},[u]);return s.useState(void 0),s.useEffect(()=>{g(m)},[m]),e.jsx("div",{className:"w-full gap-1 h-full flex items-center justify-center pb-8",children:e.jsxs("div",{className:"w-full h-full flex flex-col border bg-white rounded-lg overflow-hidden ",children:[e.jsxs("h2",{className:"text-xs border-b font-medium flex items-center gap-2 p-2 text-blue-600 uppercase",children:[e.jsx(me,{}),"DATA SHEET"]}),e.jsx(ae,{columns:i,getCellContent:f,rows:u.length,showSearch:n,getCellsForSelection:!0,onSearchClose:l,width:"100%",height:"100%",rowMarkers:"both",useRef:s.useRef,onColumnResize:b,smoothScrollY:!0,smoothScrollX:!0,onCellClicked:r,rowSelect:"multi",gridSelection:x,onGridSelectionChange:a,isDraggable:!1,getRowThemeOverride:h=>h%2===0?void 0:{bgCell:"#F7F7F7"}})]})})}const je=async m=>{try{const r=U(),a=await q.delete(`${Y}/mssql/system-users/delete/root-menu`,{data:{ids:m},headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});return a.status===200||a.status===201?{success:!0,message:a.data.message||"Operation successful",data:a.data}:{success:!1,message:`Unexpected status code: ${a.status}`}}catch(r){return{success:!1,message:r.response?r.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:we,Text:Ae}=P;function Fe({permissions:m,isMobile:r}){const{t:a}=J();s.useRef(null),se();const[x,t]=s.useState(!1);s.useState([]);const[n,u]=s.useState([]);s.useState(G().startOf("month")),s.useState(G()),s.useState(null),s.useState(null),s.useState(!1),s.useCallback(o=>o.format("YYYYMMDD"),[]);const[g,l]=s.useState(!1);s.useState([]);const[p,i]=s.useState(null);s.useState([]);const[S,b]=s.useState(!1),[f,h]=s.useState(null),[j,k]=s.useState({columns:H.empty(),rows:H.empty()}),[T,w]=s.useState(!1),D=s.useCallback(async()=>{t(!0);try{const o=await oe();u(o.data.data||[])}catch{u([])}finally{t(!1)}},[]),C=s.useMemo(()=>ne.debounce(D,100),[D]);s.useEffect(()=>(C(),()=>{C.cancel()}),[C]);const R=()=>{l(!0)},A=()=>{l(!1)},v=(o,d)=>{let c;if(o[0]===-1){if(o[0]===-1?(c=o[1],b(!0)):(c=o[0],b(!1)),f&&f[0]===o[0]&&f[1]===o[1]){h(null),i(null);return}if(c>=0&&c<n.length){const E=n[c];i(E),h(o)}}},F=()=>{const o=j.rows.items;let d=[];return o.forEach(c=>{var B;const E=c[0],Q=c[1]-1;for(let $=E;$<=Q;$++)d.push((B=n[$])==null?void 0:B.Id)}),d.filter(c=>c!==void 0)},X=s.useCallback(async o=>{const d=F();if(d.length===0){y.warning("Vui lòng chọn ít nhất một hàng để xóa.");return}n.filter(E=>!d.includes(E.id));const c=await je(d);c.data.success?(C(),y.success(c.data.message)):y.error(c.data.message)},[n,j]);return s.useEffect(()=>{const o=d=>{(d.ctrlKey||d.metaKey)&&d.key==="f"&&(d.preventDefault(),w(!0))};return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:["ITM - ",a("Root Menu Management")]})}),e.jsxs("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsx("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(we,{level:4,className:"mt-2 uppercase opacity-85 ",children:a("Root Menu Management")}),e.jsx(he,{openModal:R,handleDeleteDataSheet:X,data:n})]})}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(ge,{data:n,onCellClicked:v,setSelection:k,selection:j,showSearch:T,setShowSearch:w})})]}),e.jsx(xe,{isOpen:g,menus:n,onClose:A,fetchDataRootMenus:D})]})]})}export{Fe as default};

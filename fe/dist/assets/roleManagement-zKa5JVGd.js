import{r as a,j as e,aK as Be,B as g,aL as Ge,s as m,a as L,aH as T,u as we,F as ee,I as Q,T as ke,R as ce,aI as be,aM as He,aN as Qe,aO as Xe,aP as Y,M as We,d as Je}from"./index-Bs9yWD0t.js";import{l as Ye}from"./lodash-Ce-vbS9w.js";import{R as Ze}from"./SaveOutlined-BK_GeTTb.js";import{R as je}from"./DeleteOutlined-BXFM3QKl.js";import{a as K}from"./tokenService-DihmZYU2.js";import{D as se}from"./index-BGbAmcFH.js";import{S as W}from"./index-B0nsmOCQ.js";import{F as h}from"./Table-vNYVzV8-.js";import{E as X}from"./constants-BUjU6TAr.js";import"./index-Dh2nLnxp.js";import"./DownOutlined-DarA9UQs.js";function es({openModalAddUserGroups:l,handleSubmitSheet:n,handleDeleteDataSheet:r,handleDeleteGroups:c}){a.useState(!1);const o=C=>{switch(C.key){case"1":r();break;case"2":c();break;default:m.info("Đang phát triển");break}},y={items:[{label:"Delete Row",key:"1",icon:e.jsx(je,{}),danger:!0},{label:"Delete Group",key:"2",icon:e.jsx(je,{}),danger:!0}],onClick:o};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be.Button,{menu:y,children:e.jsx("span",{className:"uppercase",children:"Actions"})}),e.jsx(g,{type:"primary",icon:e.jsx(Ge,{}),size:"middle",onClick:l,style:{backgroundColor:"#4F46E5",borderColor:"#4F46E5"},children:"Add Group"},"addUserGroup"),e.jsx(g,{type:"primary",icon:e.jsx(Ze,{}),size:"middle",className:"uppercase",onClick:n,style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"Save"},"save")]})}const ss=async(l,n)=>{try{const r=K(),c=await L.post(`${T}/mssql/system-users/itm-groups`,{Name:l,Comment:n},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});return c.status===200||c.status===201?{success:!0,message:c.data.message||"Operation successful",data:c.data}:{success:!1,message:`Unexpected status code: ${c.status}`}}catch(r){return{success:!1,message:r.response?r.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Title:ts}=ke,{TextArea:as}=Q;function ns({isOpen:l,onClose:n,fetchDataGroups:r}){const{t:c}=we(),[o]=ee.useForm(),d=async y=>{const{name:C,comment:p}=y;try{const f=await ss(C,p);f.success?(m.success(c("Tạo nhóm thành công")),r(),o.resetFields(),n()):m.error(f.message||c("Lỗi khi tạo nhóm"))}catch{m.error(c("Lỗi khi tạo nhóm"))}};return e.jsx(se,{title:e.jsx(ts,{level:4,children:c("Thêm nhóm")}),open:l,closable:!1,width:900,extra:[e.jsx(g,{onClick:n,children:c("Cancel")},"cancel"),e.jsx(g,{type:"primary",className:" ml-2 border-gray-200  bg-indigo-600 text-white  shadow-sm text-sm",onClick:()=>o.submit(),children:c("Save")},"submit")],children:e.jsxs(ee,{form:o,layout:"vertical",onFinish:d,style:{textAlign:"left"},children:[e.jsx(ee.Item,{label:c("Tên nhóm"),name:"name",rules:[{required:!0,message:c("add_page.rules_group")}],style:{textAlign:"left"},children:e.jsx(Q,{size:"large"})}),e.jsx(ee.Item,{label:c("Ghi chú"),name:"comment",style:{textAlign:"left"},children:e.jsx(as,{rows:4,size:"large"})})]})})}const rs=async()=>{try{const l=K();return{success:!0,data:(await L.get(`${T}/mssql/system-users/itm-groups-all`,{params:{},headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})).data}}catch(l){return{success:!1,message:l.response?l.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},os=async l=>{try{const n=K();return{success:!0,data:(await L.get(`${T}/mssql/system-users/root-menus-not-in-role`,{params:{groupId:l},headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).data}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},ls=async(l,n,r)=>{try{const c=K(),o=await L.post(`${T}/mssql/system-users/itm-roles-root-menus`,{rootMenuIds:l,groupId:n,type:r},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});return o.status===200||o.status===201?{success:!0,message:o.data.message||"Operation successful",data:o.data}:{success:!1,message:`Unexpected status code: ${o.status}`}}catch(c){return{success:!1,message:c.response?c.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Option:re}=W;function cs({isOpen:l,onClose:n,groupId:r,fetchData1:c}){const[o,d]=a.useState(""),[y,C]=a.useState(!0),[p,f]=a.useState(null),[V,S]=a.useState(1),[E,B]=a.useState(50),[x,F]=a.useState(0),[b,I]=a.useState([]),[R,j]=a.useState([]),[v,k]=a.useState([]),[O,w]=a.useState(""),U=async()=>{C(!0);try{const t=await os(r);t.success&&(j(t.data),k(t.data))}catch(t){f(t.message||"Đã xảy ra lỗi"),j([]),k([])}finally{C(!1)}};a.useEffect(()=>{l&&U()},[l,r]);const N=t=>{S(t.current),B(t.pageSize)},_=async()=>{if(!b||b.length===0){m.warning("Vui lòng chọn ít nhất một mục.");return}if(!r){m.warning("Vui lòng chọn nhóm.");return}try{const t=await ls(b,r,"rootmenu");t&&t.success?(m.success("Cập nhật thành công"),I([]),n(),c()):m.error((t==null?void 0:t.message)||"Cập nhật thất bại!")}catch(t){console.error("Error:",t),m.error("Lỗi khi thêm!")}},$=()=>{if(!o||!O)return;const t=R.filter(i=>{var z;return(z=i[O])==null?void 0:z.toString().toLowerCase().includes(o.toLowerCase())});k(t)},q=()=>{d(""),w(""),k(R)},P=[{title:"Label",dataIndex:"Label",key:"Label",sorter:(t,i)=>t.Label.localeCompare(i.Label)},{title:"Link",dataIndex:"Link",key:"Link",sorter:(t,i)=>t.Link.localeCompare(i.Link)},{title:"Key",dataIndex:"Key",key:"Key",sorter:(t,i)=>t.Key.localeCompare(i.Key)}];return e.jsxs(se,{styles:{wrapper:{borderRadius:"16px 16px 0 0",overflow:"hidden"}},placement:"bottom",open:l,closable:!1,onCancel:n,height:"97%",footer:[e.jsx(g,{onClick:n,style:{backgroundColor:"#f5f5f5",borderColor:"#d9d9d9"},children:"Thoát"},"cancel"),e.jsx(g,{type:"primary",onClick:_,className:"ml-5",style:{backgroundColor:"#1890ff",borderColor:"#1890ff"},children:"Lưu"},"submit")],children:[e.jsx("div",{className:"font-medium text-xs mb-4",children:"DATA ROOT MENU"}),e.jsxs("div",{style:{marginBottom:16},className:"border w-full  p-3 rounded-lg flex gap-3",children:[e.jsxs(W,{placeholder:"Chọn cột tìm kiếm",value:O,onChange:w,size:"middle",className:"w-32",children:[e.jsx(re,{value:"Label",children:"Label"}),e.jsx(re,{value:"Link",children:"Link"}),e.jsx(re,{value:"Key",children:"Key"})]}),e.jsx(Q,{placeholder:"Nhập từ khóa tìm kiếm",value:o,onChange:t=>d(t.target.value),size:"middle"}),e.jsx(g,{type:"primary",icon:e.jsx(ce,{}),onClick:$,style:{marginRight:8},children:"Tìm kiếm"}),e.jsx(g,{onClick:q,children:"Reset"})]}),e.jsx(h,{rowSelection:{selectedRowKeys:b,onChange:I,selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},size:"small",bordered:!0,columns:P,dataSource:v,rowKey:"Id",className:"cursor-pointer pb-0",loading:y,pagination:{current:V,pageSize:E,total:x,showSizeChanger:!0,onChange:(t,i)=>N({current:t,pageSize:i})},onChange:t=>N(t)})]})}const is=async l=>{try{const n=K();return{success:!0,data:(await L.get(`${T}/mssql/system-users/users-not-in-role`,{params:{groupId:l},headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).data}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},ds=async(l,n,r)=>{try{const c=K(),o=await L.post(`${T}/mssql/system-users/itm-roles-users`,{userIds:l,groupId:n,type:r},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});return o.status===200||o.status===201?{success:!0,message:o.data.message||"Operation successful",data:o.data}:{success:!1,message:`Unexpected status code: ${o.status}`}}catch(c){return{success:!1,message:c.response?c.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Option:oe}=W;function us({isOpen:l,onClose:n,groupId:r,fetchData3:c}){const[o,d]=a.useState(!0),[y,C]=a.useState(null),[p,f]=a.useState(1),[V,S]=a.useState(50),[E,B]=a.useState(0),[x,F]=a.useState([]),[b,I]=a.useState([]),[R,j]=a.useState([]),[v,k]=a.useState(""),[O,w]=a.useState(""),U=async()=>{d(!0);try{const t=await is(r);t.success&&(I(t.data),j(t.data))}catch(t){C(t.message||"Đã xảy ra lỗi"),I([]),j([])}finally{d(!1)}};a.useEffect(()=>{l&&U()},[l]);const N=t=>{f(t.current),S(t.pageSize)},_=async()=>{try{(await ds(x,r,"user")).success&&(m.success("Cập nhật thành công"),F([]),n(),c())}catch{m.error("Lỗi khi thêm người dùng!")}},$=()=>{if(!v||!O)return;let t=b.filter(i=>{var z;return(z=i[O])==null?void 0:z.toString().toLowerCase().includes(v.toLowerCase())});j(t)},q=()=>{k(""),w(""),j(b)},P=[{title:"UserSeq",dataIndex:"UserSeq",key:"UserSeq"},{title:"UserId",dataIndex:"UserId",key:"UserId",sorter:(t,i)=>t.UserId.localeCompare(i.UserId)},{title:"UserName",dataIndex:"UserName",key:"UserName",sorter:(t,i)=>t.UserName.localeCompare(i.UserName)}];return e.jsxs(se,{styles:{wrapper:{borderRadius:"16px 16px 0 0",overflow:"hidden"}},placement:"bottom",open:l,closable:!1,onCancel:n,height:"97%",footer:[e.jsx(g,{onClick:n,style:{backgroundColor:"#f5f5f5",borderColor:"#d9d9d9"},children:"Thoát"},"cancel"),e.jsx(g,{type:"primary",className:"ml-5",onClick:_,style:{backgroundColor:"#1890ff",borderColor:"#1890ff"},children:"Lưu"},"submit")],children:[e.jsx("div",{className:"font-medium text-xs mb-4",children:"DATA USERS"}),e.jsxs("div",{style:{marginBottom:16},className:"border w-full  p-3 rounded-lg flex gap-3",children:[e.jsxs(W,{placeholder:"Chọn cột tìm kiếm",value:O,onChange:w,size:"middle",className:"w-32",children:[e.jsx(oe,{value:"UserSeq",children:"UserSeq"}),e.jsx(oe,{value:"UserId",children:"UserId"}),e.jsx(oe,{value:"UserName",children:"UserName"})]}),e.jsx(Q,{placeholder:"Nhập từ khóa tìm kiếm",value:v,size:"middle",onChange:t=>k(t.target.value)}),e.jsx(g,{type:"primary",icon:e.jsx(ce,{}),onClick:$,style:{marginRight:8},children:"Tìm kiếm"}),e.jsx(g,{onClick:q,children:"Reset"})]}),e.jsx(h,{rowSelection:{selectedRowKeys:x,onChange:F,selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},size:"small",bordered:!0,columns:P,dataSource:R,rowKey:"UserId",className:"cursor-pointer pb-0",loading:o,pagination:{current:p,pageSize:V,total:E,showSizeChanger:!0,onChange:(t,i)=>N({current:t,pageSize:i})},onChange:t=>N(t)})]})}const ms=async l=>{try{const n=K();return{success:!0,data:(await L.get(`${T}/mssql/system-users/menus-not-in-role`,{params:{groupId:l},headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).data}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},hs=async(l,n,r)=>{try{const c=K(),o=await L.post(`${T}/mssql/system-users/itm-roles-menus`,{menuIds:l,groupId:n,type:r},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});return o.status===200||o.status===201?{success:!0,message:o.data.message||"Operation successful",data:o.data}:{success:!1,message:`Unexpected status code: ${o.status}`}}catch(c){return{success:!1,message:c.response?c.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},{Option:le}=W;function ps({isOpen:l,onClose:n,groupId:r,fetchData2:c}){const[o,d]=a.useState(""),[y,C]=a.useState(""),[p,f]=a.useState(!0),[V,S]=a.useState(null),[E,B]=a.useState(1),[x,F]=a.useState(50),[b,I]=a.useState(0),[R,j]=a.useState([]),[v,k]=a.useState([]),[O,w]=a.useState([]),U=async()=>{f(!0);try{const t=await ms(r);t.success&&(k(t.data),w(t.data))}catch(t){S(t.message||"Đã xảy ra lỗi"),k([]),w([])}finally{f(!1)}};a.useEffect(()=>{l&&U()},[l,r,E,x]);const N=async()=>{if(!R||R.length===0){m.warning("Vui lòng chọn ít nhất một mục.");return}if(!r){m.warning("Vui lòng chọn nhóm.");return}try{const t=await hs(R,r,"menu");t&&t.success?(m.success("Cập nhật thành công"),j([]),n(),c()):m.error((t==null?void 0:t.message)||"Cập nhật thất bại!")}catch(t){console.error("Error:",t),m.error("Lỗi khi thêm!")}},_=()=>{if(!o||!y)return;const t=v.filter(i=>{var z;return(z=i[y])==null?void 0:z.toString().toLowerCase().includes(o.toLowerCase())});w(t)},$=()=>{d(""),C(""),w(v)},q=[{title:"Label",dataIndex:"Label",key:"Label",sorter:(t,i)=>t.Label.localeCompare(i.Label)},{title:"Link",dataIndex:"Link",key:"Link",sorter:(t,i)=>t.Link.localeCompare(i.Link)},{title:"Key",dataIndex:"Key",key:"Key",sorter:(t,i)=>t.Key.localeCompare(i.Key)}],P=t=>{B(t.current),F(t.pageSize)};return e.jsxs(se,{styles:{wrapper:{borderRadius:"16px 16px 0 0",overflow:"hidden"}},placement:"bottom",open:l,closable:!1,onCancel:n,height:"97%",footer:[e.jsx(g,{onClick:n,style:{backgroundColor:"#f5f5f5",borderColor:"#d9d9d9"},children:"Thoát"},"cancel"),e.jsx(g,{type:"primary",className:"ml-5",onClick:N,style:{backgroundColor:"#1890ff",borderColor:"#1890ff"},children:"Lưu"},"submit")],children:[e.jsx("div",{className:"font-medium text-xs mb-4",children:"DATA MENU"}),e.jsxs("div",{style:{marginBottom:16},className:"border w-full  p-3 rounded-lg flex gap-3",children:[e.jsxs(W,{placeholder:"Chọn cột tìm kiếm",value:y,onChange:C,size:"middle",className:"w-32",children:[e.jsx(le,{value:"Label",children:"Label"}),e.jsx(le,{value:"Link",children:"Link"}),e.jsx(le,{value:"Key",children:"Key"})]}),e.jsx(Q,{placeholder:"Nhập từ khóa tìm kiếm",value:o,onChange:t=>d(t.target.value),size:"middle"}),e.jsx(g,{type:"primary",icon:e.jsx(ce,{}),onClick:_,style:{marginRight:8},children:"Tìm kiếm"}),e.jsx(g,{onClick:$,children:"Reset"})]}),e.jsx(h,{rowSelection:{selectedRowKeys:R,onChange:j,selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},size:"small",bordered:!0,columns:q,dataSource:O,rowKey:"Id",className:"cursor-pointer pb-0",loading:p,pagination:{current:E,pageSize:x,total:b,showSizeChanger:!0,showTotal:t=>`Total ${t} Item`,onChange:(t,i)=>P({current:t,pageSize:i})},onChange:t=>P(t)})]})}const gs=async(l,n,r,c)=>{try{const o=`${T}/mssql/system-users/roles-paginated-root-menu`,d=await L.get(o,{params:{groupId:l,type:n,page:r,limit:c},headers:{"Content-Type":"application/json"}});return d.status===200?{success:!0,data:d.data.data,total:d.data.total,totalPages:d.data.totalPages}:{success:!1,message:X.ERROR}}catch(o){return{success:!1,message:o.response?o.response.data.message:X.ERROR}}},fs=async(l,n,r,c)=>{try{const o=`${T}/mssql/system-users/roles-paginated-menu`,d=await L.get(o,{params:{groupId:l,type:n,page:r,limit:c},headers:{"Content-Type":"application/json"}});return d.status===200?{success:!0,data:d.data.data,total:d.data.total,totalPages:d.data.totalPages}:{success:!1,message:X.ERROR}}catch(o){return{success:!1,message:o.response?o.response.data.message:X.ERROR}}},xs=async(l,n,r,c)=>{try{const o=`${T}/mssql/system-users/roles-paginated-users`,d=await L.get(o,{params:{groupId:l,type:n,page:r,limit:c},headers:{"Content-Type":"application/json"}});return d.status===200?{success:!0,data:d.data.data,total:d.data.total,totalPages:d.data.totalPages}:{success:!1,message:X.ERROR}}catch(o){return{success:!1,message:o.response?o.response.data.message:X.ERROR}}},{Header:Ps,Content:ys,Footer:Vs}=Xe,Cs={borderInlineEnd:"none"};function Ss({groups:l,changedIds:n,setChangedIds:r,setSelectedRowKeys:c,selectedRowKeys:o,setCheckStatus:d,checkStatus:y,setSelectedGroup:C,selectedGroup:p,setOpenView:f,openView:V}){const[S,E]=a.useState({groupName:"",note:""}),[B,x]=a.useState(!0);a.useState(!0);const[F,b]=a.useState(null),[I,R]=a.useState(1),[j,v]=a.useState(1),[k,O]=a.useState(1),[w,U]=a.useState(50),[N,_]=a.useState(50),[$,q]=a.useState(50),[P,t]=a.useState(50),[i,z]=a.useState(50),[Ne,Ie]=a.useState(50),[Is,Re]=a.useState(50),[Rs,Le]=a.useState(50),[Ls,Te]=a.useState(50),[Ee,ie]=a.useState(!1),[ve,de]=a.useState(!1),[Oe,ue]=a.useState(!1),[me,te]=a.useState([]);a.useState([]);const[he,ae]=a.useState([]),[Ue,pe]=a.useState([]),ne=(s,u)=>{c(D=>({...D,[u]:s}))},ge=async()=>{x(!0);try{const s=await gs(p,"rootmenu",I,w);s.success&&(te(s.data),t(s.data.total),Te(s.data.totalPages),d(!1))}catch(s){b(s.message||"Đã xảy ra lỗi"),te([])}finally{x(!1)}},fe=a.useCallback(async()=>{x(!0);try{const s=await fs(p,"menu",j,N);s.success&&(ae(s.data),z(s.data.total),d(!1),Le(s.data.totalPages))}catch(s){b(s.message||"Đã xảy ra lỗi"),ae([])}finally{x(!1)}},[p,j,N]),xe=async()=>{x(!0);try{const s=await xs(p,"user",k,$);s.success&&(pe(s.data),Ie(s.total),Re(s.totalPages),d(!1))}catch(s){b(s.message||"Đã xảy ra lỗi"),pe([])}finally{x(!1)}};a.useEffect(()=>{(p!==null||!y)&&(ge(),fe(),xe())},[p,y]);const De=()=>{ie(!0)},ze=()=>{ie(!1)},Me=()=>{de(!0)},Ae=()=>{de(!1)},Ke=()=>{ue(!0)},$e=()=>{ue(!1)},Pe=s=>{C(s),f(!0);const u=l.find(D=>D.Id===s);E({groupName:u.Name,note:`${u.Comment}`})},Ve=(s,u)=>{const D=[...me],G=D.findIndex(M=>M.Id===s);if(G!==-1){const M=!D[G][u];D[G][u]=M,te(D),r(H=>{const J=H.findIndex(A=>A.id===s&&A.column===u);if(J!==-1){const A=[...H];return A[J]={id:s,column:u,value:M},A}return[...H,{id:s,column:u,value:M}]})}},Z=(s,u)=>{const D=[...he],G=D.findIndex(M=>M.Id===s);if(G!==-1){const M=!D[G][u];D[G][u]=M,ae(D),r(H=>{const J=H.findIndex(A=>A.id===s&&A.column===u);if(J!==-1){const A=[...H];return A[J]={id:s,column:u,value:M},A}return[...H,{id:s,column:u,value:M}]})}},_e=[{title:"UserId",dataIndex:"UserId",key:"UserId"},{title:"UserName",dataIndex:"UserName",key:"UserName"}],qe=[{title:"Name",dataIndex:"Label",key:"Label"},{title:"View",dataIndex:"View",key:"View",render:(s,u)=>e.jsx(Y,{checked:s,onChange:()=>Ve(u.Id,"View")})}],Fe=[{title:"MenuType",dataIndex:"MenuType",key:"MenuType"},{title:"Name",dataIndex:"Label",key:"Label"},{title:"View",dataIndex:"View",key:"View",render:(s,u)=>e.jsx(Y,{checked:s,onChange:()=>Z(u.Id,"View")})},{title:"Edit",dataIndex:"Edit",key:"Edit",render:(s,u)=>e.jsx(Y,{checked:s,onChange:()=>Z(u.Id,"Edit")})},{title:"Create",dataIndex:"Create",key:"Create",render:(s,u)=>e.jsx(Y,{checked:s,onChange:()=>Z(u.Id,"Create")})},{title:"Delete",dataIndex:"Delete",key:"Delete",render:(s,u)=>e.jsx(Y,{checked:s,onChange:()=>Z(u.Id,"Delete")})}],ye=s=>{O(s.current),q(s.pageSize)},Ce=s=>{v(s.current),_(s.pageSize)},Se=s=>{R(s.current),U(s.pageSize)};return e.jsxs("div",{className:"w-full gap-3 h-full flex items-center justify-center",children:[e.jsxs("div",{className:"w-1/4 h-full flex flex-col bg-white border rounded-lg overflow-hidden pb-10",children:[e.jsx("div",{className:"font-medium text-xs mb-4 text-gray-700 uppercase p-3",children:"NHÓM NGƯỜI DÙNG"}),e.jsx(be,{style:Cs,mode:"inline",selectedKeys:[p==null?void 0:p.toString()],onClick:s=>{Pe(Number(s.key)),r([])},className:" border-none border-r-0",children:l.map(s=>e.jsx(be.Item,{icon:e.jsx(He,{}),children:s==null?void 0:s.Name},s==null?void 0:s.Id))})]}),e.jsxs("div",{className:"w-10/12 h-full flex flex-col border bg-white p-3 rounded-lg  overflow-auto  scroll-container pb-10",children:[e.jsx("div",{className:"font-medium text-xs mb-4",children:"NGƯỜI DÙNG"}),V?e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"mb-4",children:[e.jsx(Q,{value:S.groupName,onChange:s=>E({...S,groupName:s.target.value}),placeholder:"Nhập tên nhóm",className:"w-full mb-2"}),e.jsx(Q.TextArea,{value:S.note,onChange:s=>E({...S,note:s.target.value}),placeholder:"Ghi chú",rows:4})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-medium text-xs mb-2 uppercase",children:"Quyền Truy Nhóm Menu"}),e.jsx(h,{dataSource:me,columns:qe,rowKey:"Id",size:"small",rowSelection:{selectedRowKeys:o.table1,onChange:s=>ne(s,"table1"),selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},pagination:{current:I,pageSize:w,total:P,showSizeChanger:!0,showTotal:s=>`Total ${s} Item`,onChange:(s,u)=>Se({current:s,pageSize:u})},onChange:s=>Se(s),bordered:!0,footer:()=>e.jsx("span",{type:"primary",onClick:De,className:"mt-2 max-w-md cursor-pointer text-pretty text-base text-indigo-500",size:"large",children:"Add Row"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-medium text-xs mb-2 uppercase",children:"Quyền Truy Cập Menu"}),e.jsx(h,{dataSource:he,columns:Fe,rowKey:"Id",size:"small",bordered:!0,rowSelection:{selectedRowKeys:o.table2,onChange:s=>ne(s,"table2"),selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},pagination:{current:j,pageSize:N,total:i,showSizeChanger:!0,showTotal:s=>`Total ${s} Item`,onChange:(s,u)=>Ce({current:s,pageSize:u})},onChange:s=>Ce(s),footer:()=>e.jsx("span",{type:"primary",className:"mt-2 max-w-md cursor-pointer text-pretty text-base text-indigo-500",size:"small",onClick:Me,children:"Add Row"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-medium text-xs mb-2 uppercase",children:"Danh Sách Người Dùng"}),e.jsx(h,{dataSource:Ue,columns:_e,rowKey:"Id",size:"small",bordered:!0,rowSelection:{selectedRowKeys:o.table3,onChange:s=>ne(s,"table3"),selections:[h.SELECTION_ALL,h.SELECTION_INVERT,h.SELECTION_NONE]},pagination:{current:k,pageSize:$,total:Ne,showSizeChanger:!0,showTotal:s=>`Total ${s} Item`,onChange:(s,u)=>ye({current:s,pageSize:u})},onChange:s=>ye(s),footer:()=>e.jsx("span",{type:"primary",className:"mt-2 max-w-md cursor-pointer text-pretty text-base text-indigo-500",size:"large",onClick:Ke,children:"Add Row"})})]})]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ys,{className:"flex flex-col  justify-center items-center px-4",children:e.jsx("div",{className:"text-center  justify-center",children:e.jsx("img",{src:Qe,className:" w-96 opacity-45 h-auto mb-10",alt:"Background"})})})]}),e.jsx(cs,{isOpen:Ee,onClose:ze,groupId:p,fetchData1:ge}),e.jsx(ps,{isOpen:ve,onClose:Ae,groupId:p,fetchData2:fe}),e.jsx(us,{isOpen:Oe,onClose:$e,groupId:p,fetchData3:xe})]})]})}const bs=async l=>{try{const n=K(),r=await L.post(`${T}/mssql/system-users/update/roles-user`,l,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});return r.status===200||r.status===201?{success:!0,message:r.data.message||"Operation successful",data:r.data}:{success:!1,message:`Unexpected status code: ${r.status}`}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},js=async l=>{try{const n=K(),r=await L.delete(`${T}/mssql/system-users/delete/roles-user`,{data:{ids:l},headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});return r.status===200||r.status===201?{success:!0,message:r.data.message||"Operation successful",data:r.data}:{success:!1,message:`Unexpected status code: ${r.status}`}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}},ws=async l=>{try{const n=K(),r=await L.delete(`${T}/mssql/system-users/delete/groups`,{data:{ids:l},headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});return r.status===200||r.status===201?{success:!0,message:r.data.message||"Operation successful",data:r.data}:{success:!1,message:`Unexpected status code: ${r.status}`}}catch(n){return{success:!1,message:n.response?n.response.data.message||"Có lỗi xảy ra":"Không thể kết nối tới server"}}};function ks({modalOpen:l,setModalOpen:n,selectedGroup:r,setSelectedGroup:c,setOpenView:o,fetchDataGroups:d}){const y=a.useCallback(async()=>{(await ws([r])).success?(m.success("Delete successful!"),o(!1),n(!1),d()):m.error("Save failed!")},[r]);return e.jsx(We,{centered:!0,open:l,onCancel:()=>n(!1),footer:null,closable:!1,children:e.jsxs("div",{className:"items-center justify-center flex flex-col",children:[e.jsx("p",{className:"text-lg font-bold",children:"Xác nhận xóa nhóm phân quyền"}),e.jsxs("p",{className:"mt-4 text-gray-600 text-center",children:["Bạn có chắc chắn muốn xóa ",e.jsx("b",{children:"Group phân quyền"})," này không?",e.jsx("br",{}),"Việc xóa sẽ dẫn đến ",e.jsx("b",{children:"toàn bộ các quyền liên quan"})," bị xóa và không thể khôi phục. Hãy kiểm tra kỹ trước khi thực hiện."]}),e.jsxs("div",{className:"flex justify-end w-full mt-6",children:[e.jsx(g,{onClick:()=>n(!1),className:"mr-2",children:"Hủy bỏ"}),e.jsx(g,{type:"primary",danger:!0,onClick:y,children:"Xóa"})]})]})})}const{Title:Ns,Text:_s}=ke;function qs({permissions:l,isMobile:n}){const{t:r}=we();a.useRef(null);const[c,o]=a.useState(!1),[d,y]=a.useState([]),[C,p]=a.useState([]),[f,V]=a.useState([]),[S,E]=a.useState({table1:[],table2:[],table3:[]}),[B,x]=a.useState(!1),[F,b]=a.useState(!1),[I,R]=a.useState(null),[j,v]=a.useState(!1),k=()=>[...S.table1,...S.table2,...S.table3],[O,w]=a.useState(!1),U=a.useCallback(async()=>{o(!0);try{const i=await rs();p(i.data.data||[])}catch{p([])}finally{o(!1)}},[]),N=a.useMemo(()=>Ye.debounce(U,100),[U]);a.useEffect(()=>(N(),()=>{N.cancel()}),[N]);const _=()=>{w(!0)},$=()=>{w(!1)},q=a.useCallback(async()=>{if(f.length===0){m.warning("No changes to submit.");return}(await bs(f)).success?(m.success("Save successful!"),V([])):m.error("Save failed!")},[f]),P=a.useCallback(async()=>{const i=k();if(i.length===0){m.warning("No rows selected.");return}(await js(i)).success?(m.success("Delete successful!"),v(!0),E({table1:[],table2:[],table3:[]})):m.error("Save failed!")},[S]),t=a.useCallback(async()=>{if(!I){m.warning("Không có nhóm để xoá!");return}b(!0)},[I]);return e.jsxs(e.Fragment,{children:[e.jsx(Je,{children:e.jsxs("title",{children:["ITM - ",r("Role Management")]})}),e.jsxs("div",{className:"bg-slate-50 p-3 h-screen overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-4 md:grid-rows-[auto_1fr] md:gap-4 h-full",children:[e.jsx("div",{className:"col-start-1 col-end-5 row-start-1 w-full rounded-lg ",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ns,{level:4,className:"mt-2 uppercase opacity-85 ",children:r("Role Management")}),e.jsx(es,{fetchDataGroups:U,openModalAddUserGroups:_,handleSubmitSheet:q,handleDeleteDataSheet:P,handleDeleteGroups:t})]})}),e.jsx("div",{className:"col-start-1 col-end-5 row-start-2 w-full h-full rounded-lg  overflow-auto",children:e.jsx(Ss,{data:d,loading:c,groups:C,setChangedIds:V,changedIds:f,setSelectedRowKeys:E,selectedRowKeys:S,setCheckStatus:v,setSelectedGroup:R,checkStatus:j,selectedGroup:I,setOpenView:x,openView:B})})]}),e.jsx(ns,{isOpen:O,onClose:$,fetchDataGroups:U}),e.jsx(ks,{modalOpen:F,setModalOpen:b,selectedGroup:I,setSelectedGroup:R,setOpenView:x,fetchDataGroups:U})]})]})}export{qs as default};
